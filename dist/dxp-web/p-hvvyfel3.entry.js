import{r as s,d as t,h as e,g as i}from"./p-8188e849.js";import{B as h}from"./p-16d6f0ca.js";import{m as a,x as c}from"./p-72849a34.js";const r=class{constructor(t){s(this,t),this.count=-1,this.contentSuggesterData=[],this.responseData=[],this.searchDataCombined=[],this.searchFilteredData=[],this.searchValue="",this.showSearchDropdown=!1,this.cfq="",this.cfqLocale="",this.searchedTerm="",this.searchedText=""}componentWillLoad(){this.base=new h(this,t),this.base.i18Init(t,"Search",a),this.suggestApiUrl&&this.suggestCount&&this.suggestDictionary&&this.suggestCollection&&this.cfq&&(this.cfqLocale=this.cfqLocale?this.cfqLocale:this.locale.toLowerCase().replace("_","-"),this.suggestEndPoint=`${this.suggestApiUrl+this.suggestCollection}`,this.suggesterConfig={"suggest.count":this.suggestCount,"suggest.dictionary":this.suggestDictionary,suggest:"true","suggest.cfq":encodeURIComponent(t.util.addEscapeCharacter(`${this.cfq}${this.cfqLocale}*`))})}componentDidLoad(){this.inputBoxSearch=this.element.querySelector(".searchbox")}componentWillUpdate(){this.searchValue=this.searchedTerm?this.searchedTerm:this.searchValue}clickEvent(s){s.target.classList.contains("dxp-list-container")||s.target.classList.contains("searchbox")||(this.showSearchDropdown=!1)}handleKeyUp(s){const t=s.target?s.target.activeElement:s.target,e=t,i=s.keyCode,h=t.classList.contains("searchbox"),a=t.classList.contains("dxp-icon-search"),c=t.classList.contains("dxp-icon-clear");13!==i&&32!==i||(e.classList.contains("list-element")&&(this.searchValue=t.innerText,this.showSearchDropdown=!1),(a||13===i&&h)&&(this.showSearchDropdown=!1),c&&(this.clearSearchBox(),this.inputBoxSearch.focus()))}routingHandler(s){this.base.routingEventListener(s)}clearSearchBox(){const s=this.getInputElement();s&&(s.value="",this.searchValue=this.searchedTerm="")}getInputElement(){return this.element.querySelector(".searchbox")}async getSuggestData(s,e,i){let h;h=s,e.indexOf("suggest")>-1&&(h["suggest.q"]=encodeURIComponent(i));const a={method:"POST",body:Object.keys(h).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(h[s])}`).join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}};try{c.request&&c.request.abort();const s=c.fetchRequest(e,a).then(s=>(t.log.debug(this.element.tagName,"getSuggestData()","xhr request success"),JSON.parse(s.response))).catch(s=>{t.log.debug(this.element.tagName,"getSuggestData()",`xhr request cancelled/failed : ${JSON.stringify(s)}`)});return this.responseData=s,this.responseData}catch(r){t.log.error(this.element.tagName,"getSuggestData()","fetch failed",r)}}async handleChange(s){let t;if(this.count=-1,this.searchDataCombined=[],this.contentSuggesterData=[],this.searchFilteredData=[],this.searchValue=s,(t=this.searchValue.trim()).length>=3){this.responseData=await this.getSuggestData(this.suggesterConfig,this.suggestEndPoint,t),this.responseData&&this.responseData.suggest&&(this.contentSuggesterData=this.responseData.suggest.contentSuggester),this.contentSuggesterData[t]&&(this.searchFilteredData=this.contentSuggesterData[t].suggestions);for(const s of this.searchFilteredData){let e=s.term.toLowerCase();const i=e.indexOf(t.toLowerCase()),h=(e=e.substr(i,e.length)).split(" "),a=h.length;e="";for(let s=0;s<a&&s<5;s++)e+=h[s],e+=" ";this.searchDataCombined.push(e)}this.searchDataCombined=this.removeDuplicates(this.searchDataCombined),this.showSearchDropdown=this.searchDataCombined.length>0}}onTextInput(s){this.searchedTerm="",this.handleChange(s.target.value).then(()=>t.log.info(this.element.tagName,"onTextInput()","in handleChange")).catch(s=>t.log.error(this.element.tagName,"onTextInput()",`in handleChange :${s}`))}removeDuplicates(s){return s=s.filter((t,e)=>s.indexOf(t)===e),Array.from(s)}setSearchValue(s){this.showSearchDropdown=!1,this.searchValue.trim().length>=3&&s.setValue(this.searchValue)}render(){const s=document.querySelector("dxp-search-result");return t.log.debug(this.element.tagName,"render()","in dxp-searchbox render() : DEVELOPMENT"),[e("div",{class:"sc-dxp-search-result dxp-col-12 dxp-col-lg-6 search-box-wrapper dxp-p-0"},e("div",{class:"sc-dxp-search-result"},e("div",{class:"sc-dxp-search-result dxp-search-info"},this.searchedText?[e("span",{class:"sc-dxp-search-result"},t.i18n.t("Search:searchMessage")),e("span",{class:"search-keywords"},` ${this.searchedText}`," ")]:""),e("div",{class:"sc-dxp-search-result dxp-search-count result-count-align"},"noresult"===this.noResultFlag&&this.searchedText?e("span",null,t.i18n.t("Search:noResultFound")):""===this.searchedText?"":this.resultCount?e("span",null,`${this.resultCount} `,t.i18n.t("Search:searchFound")):"")),e("div",{role:"application",class:"sc-dxp-search-result wrapper"},e("input",{type:"text",role:"combobox","aria-haspopup":"listbox",name:"searchbox","aria-label":t.i18n.t("Search:customMessage"),value:this.searchValue||this.searchedTerm,onInput:s=>{this.onTextInput(s)},class:`sc-dxp-search-result dxp-form-control searchbox${this.showSearchDropdown&&this.searchValue.length>=3?" no-border-radius":""}`,placeholder:this.placeholder}),e("span",{tabindex:"0","aria-label":t.i18n.t("Search:searchIconAccessibilityText"),class:"sc-dxp-search-result dxp-icon dxp-icon-medium dxp-icon-search",onClick:()=>this.setSearchValue(s)}),e("span",{tabindex:"0","aria-label":t.i18n.t("Search:clear"),class:`sc-dxp-search-result dxp-icon dxp-icon-small dxp-icon-close dxp-icon-clear${this.searchValue.length?" dxp-block":" dxp-none"}`,onClick:()=>this.clearSearchBox()}),e("div",{class:`dxp-list-container sc-dxp-search-result ${this.showSearchDropdown&&this.searchValue.length>=3?"dxp-block":""}`},e("ul",{class:"dxp-dropdown-list sc-dxp-search-result","aria-label":t.i18n.t("Search:listText")},this.searchDataCombined&&this.searchDataCombined.map((i,h)=>e("li",{class:"list-element sc-dxp-search-result",id:`opt-${h+1}`,"aria-label":t.i18n.t("Search:selectedItem",{item:i}),onClick:async()=>{this.searchValue=i,await s.setValue(i)},tabindex:"-1"},i," ")))))),e("div",{class:"sc-dxp-search-result dxp-col-12 dxp-bold"},"noresult"===this.noResultFlag&&this.searchedText?e("div",{class:"sc-dxp-search-result search-terms",innerHTML:this.errorText}):"")]}get element(){return i(this)}};export{r as dxp_searchbox};