import{r as t,c as e,d as s,h as i,g as o}from"./p-8188e849.js";import{B as a}from"./p-16d6f0ca.js";const c={en:{placeholder:"All Location",searchIconAccessibilityText:"Click search icon",listText:"Select search item from list",clear:"Click to clear search box",close:"Click to close search popup",closeText:"Close",customMessage:"Please enter search keyword. Autosuggestions will be shown after 3 characters",noResultFound:"No result found"},es:{placeholder:"Buscar",searchIconAccessibilityText:"Haga clic en el icono de búsqueda",listText:"Seleccione el elemento de búsqueda de la lista",selectedItem:"Seleccionado actualmente {{item}}",close:"Haga clic para cerrar la ventana emergente de búsqueda",closeText:"Cerrar",clearText:"Claro",customMessage:"Por favor introduzca la palabra clave de búsqueda. Se mostrarán autosugestiones después de 3 caracteres"}};let l;const n=new XMLHttpRequest,r=l={request:n,fetchRequest:(t,e)=>new Promise((s,i)=>{n.onreadystatechange=()=>{4===n.readyState&&(n.status>=200&&n.status<300?s(n):i({status:n.status,statusText:n.statusText}))},n.onerror=()=>{i({status:n.status,statusText:n.statusText})},n.open(e.method,t,!0),e.headers&&Object.keys(e.headers).forEach(t=>{n.setRequestHeader(t,e.headers[t])}),n.send(e.body)})},h=class{constructor(s){t(this,s),this.filterItemsJson=[],this.searchValue="",this.showDownArrow=!0,this.searchLocationChanged=e(this,"searchLocationChanged",7)}componentWillLoad(){this.base=new a(this,s),this.base.i18Init(s,"LocationSelector",c)}clickEvent(t){const e=t.target?t.composedPath()[0]:t.target;e.classList.contains("dxp-dropdown-list-item")||e.classList.contains("searchbox")||e.classList.contains("dxp-icon")||(this.showSearchBoxList=!1,this.showDownArrow=!0)}async clearSearchBox(){this.clearInputFieldValue(),this.filterItemsJson=[],this.showSearchBoxList=!1,this.showDownArrow=!0}clearInputFieldValue(){const t=this.getInputElement();t&&(t.value="",this.searchValue="",this.showSearchBoxList=!this.showSearchBoxList)}findResult(t,e){let s;return t.forEach(t=>{t.types[0]===e&&"political"===t.types[1]&&(s=t)}),s?s.long_name:void 0}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.getLocationCity(t.coords.latitude,t.coords.longitude).then(t=>{this.filterItemsJson.push(t),this.filterItemsJson=[...this.filterItemsJson],this.showDownArrow=!this.showDownArrow,this.showSearchBoxList=!this.showSearchBoxList,this.responseFlag=!1}).catch(t=>{s.log.debug(this.element.tagName,"getLocation()",`current location location notfound : ${JSON.stringify(t)}`)})}):s.log.debug(this.element.tagName,"getLocation()","Sorry, your browser does not support HTML5 geolocation")}getData(t){const e={method:"GET"};try{return r.request&&r.request.abort(),r.fetchRequest(t,e).then(t=>(s.log.debug(this.element.tagName,"getData()","xhr request success"),JSON.parse(t.response))).catch(t=>{s.log.debug(this.element.tagName,"getData()",`xhr request cancelled/failed : ${JSON.stringify(t)}`)})}catch(i){s.log.error(this.element.tagName,"getData()","fetch failed",i)}}getInputElement(){return this.element.querySelector(".searchbox")}async getLocationCity(t,e){this.filterItemsJson=[];const i=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${t},${e}&key=${this.apiKey}`,o=(await s.api(i)).results[1].address_components,a=this.findResult(o,"locality"),c=this.findResult(o,"administrative_area_level_1"),l=this.findResult(o,"country"),n={};return n.description=`${a}, ${c}, ${l}`,n}onListItemSelection(t){const e=this.getInputElement();e.value=t,this.showSearchBoxList=!1,this.searchLocationChanged.emit({searchTerm:e.value}),s.log.debug(this.element.tagName,"onListItemSelection()","event emit for SPA")}onTextInput(t){this.searchValue=t.target.value,this.searchValue.trim().length>=1&&(this.showSearchBoxList=!0,this.getData(`https://maps.googleapis.com/maps/api/place/autocomplete/json?key=${this.apiKey}&types=(${this.searchType})&language=${s.i18n.languages[0]}&input=${this.searchValue}`).then(async t=>{t&&(this.filterItemsJson=t,this.filterItemsJson.predictions&&(this.filterItemsJson=this.filterItemsJson.predictions),this.filterItemsJson.length&&(this.responseFlag=!0))})),!1===this.showSearchBoxList&&(this.showSearchBoxList=!this.showSearchBoxList)}renderLocationValues(){return i("div",{class:`dxp-location-list-container  ${this.filterItemsJson&&this.filterItemsJson.length?" with-result ":""}\n       ${this.showSearchBoxList?" dxp-block":"dxp-none"}`},i("ul",{class:`dxp-suggestion-list ${this.searchValue.length?"":"current-location"}`,"aria-label":s.i18n.t("LocationSelector:listText")},this.filterItemsJson&&this.filterItemsJson.length?this.filterItemsJson.map(t=>[i("li",{tabIndex:-1,class:"dxp-dropdown-list-item"},!this.searchValue.length&&!this.responseFlag&&i("p",{class:"dxp-font-size-sm dxp-pb-3"}," Your location"),i("p",{class:"current-location-data",onClick:this.selectSuggestion.bind(this)},!this.searchValue.length&&!this.responseFlag&&i("span",{class:"dxp-icon dxp-icon-current-location",tabIndex:0,"aria-label":s.i18n.t("LocationSelector:searchIconAccessibilityText")}),t.description)),!this.searchValue.length&&!this.responseFlag&&i("li",{class:"dxp-dropdown-list-item"},"All location")]):i("li",{tabIndex:-1,class:"dxp-dropdown-list-item no-result-found","aria-label":s.i18n.t("LocationSelector:noResultFound")},i("p",null,s.i18n.t("LocationSelector:noResultFound")))))}selectSuggestion(t,e){e&&t.target&&"LI"===t.target.activeElement.tagName?this.onListItemSelection(t.target.activeElement.innerText):"P"===t.target.tagName&&this.onListItemSelection(t.target.innerText)}toggleCurrentLocation(){this.filterItemsJson&&0!==this.filterItemsJson.length?(this.showDownArrow=!this.showDownArrow,this.showSearchBoxList=!this.showSearchBoxList):this.getCurrentLocation()}render(){s.log.debug(this.element.tagName,"render()","in dxp-location-selector render() : DEVELOPMENT");const t=[i("link",{rel:"stylesheet",href:""}),[this.theme&&i("link",{rel:"stylesheet",href:""})],[this.theme&&i("link",{rel:"stylesheet",href:`${s.config.get("DXP_STYLE_BASE_URL")}/themes/${this.theme}/dxp-location-selector.min.css`})]];return i("div",{role:"application",class:`${this.base.componentClass()} search-wrapper simple-search search-box-container`,dir:this.dir,"data-theme":this.theme},t,i("div",{class:"search-box-container"},i("div",{class:"wrapper"},i("input",{type:"search","aria-haspopup":"listbox",name:"searchbox","aria-label":s.i18n.t("LocationSelector:customMessage"),class:`dxp-form-control searchbox ${this.showSearchBoxList&&this.filterItemsJson&&this.filterItemsJson.length?"dxp-border-radius":""}`,placeholder:`${this.searchLocationData?this.searchLocationData[0].placeholder:"All Location"}`,onInput:t=>{this.onTextInput(t)},onClick:()=>this.toggleCurrentLocation()}),i("span",{class:"dxp-icon dxp-icon-sm dxp-icon-globe search-text",tabIndex:0,"aria-label":s.i18n.t("LocationSelector:searchIconAccessibilityText")}),!this.searchValue.length&&i("span",{class:`dxp-icon dxp-icon-sm ${this.showDownArrow?"dxp-icon-caret-down":"dxp-icon-caret-up"}`,tabIndex:0,"aria-label":s.i18n.t("LocationSelector:searchIconAccessibilityText"),onClick:()=>this.toggleCurrentLocation()}),i("span",{class:`dxp-icon dxp-icon-sm dxp-icon-close dxp-icon-clear ${this.filterItemsJson&&this.searchValue.length>=1?" dxp-block":" dxp-none"}`,"aria-label":s.i18n.t("LocationSelector:clear"),tabIndex:0,onClick:()=>this.clearSearchBox()})),this.renderLocationValues()))}get element(){return o(this)}static get style(){return"div.dxp.dxp-location-selector.search-wrapper{padding:0}div.dxp.dxp-location-selector.search-wrapper.simple-search{background-color:transparent;width:100%}div.dxp.dxp-location-selector.search-wrapper .search-box-container,div.dxp.dxp-location-selector.search-wrapper .wrapper{position:relative}div.dxp.dxp-location-selector.search-wrapper input{line-height:2rem;padding:8px 65px 8px 47px;border-radius:19px}div.dxp.dxp-location-selector.search-wrapper .dxp-icon:focus,div.dxp.dxp-location-selector.search-wrapper input:focus{outline:none}div.dxp.dxp-location-selector.search-wrapper .searchbox.dxp-border-radius{border-bottom:0;border-bottom-left-radius:0;border-bottom-right-radius:0}div.dxp.dxp-location-selector.search-wrapper .dxp-icon-globe{position:absolute;padding:0;cursor:pointer;left:20px;top:10px}div.dxp.dxp-location-selector.search-wrapper .dxp-icon-caret-up,div.dxp.dxp-location-selector.search-wrapper .dxp-icon.dxp-icon-caret-down{position:absolute;right:16px;top:10px}div.dxp.dxp-location-selector.search-wrapper .dxp-icon-close{position:absolute;top:11px;right:16px;margin:0;padding:0;cursor:pointer}div.dxp.dxp-location-selector.search-wrapper .dxp-location-list-container{position:absolute;left:0;right:0;z-index:1;border-top:0;border-bottom-right-radius:19px;border-bottom-left-radius:19px}div.dxp.dxp-location-selector.search-wrapper .dxp-suggestion-list{list-style:none;border-bottom-left-radius:19px;border-bottom-right-radius:19px;padding:0}div.dxp.dxp-location-selector.search-wrapper .dxp-suggestion-list li{padding:10px 40px;padding-bottom:10px;position:relative}div.dxp.dxp-location-selector.search-wrapper .dxp-suggestion-list li p{margin:0}div.dxp.dxp-location-selector.search-wrapper .dxp-suggestion-list li:before{display:block;height:1px;position:absolute;top:0;width:calc(100% - 70px)}div.dxp.dxp-location-selector.search-wrapper .dxp-suggestion-list li:first-child:before{content:\"\"}div.dxp.dxp-location-selector.search-wrapper .current-location li p{margin:0}div.dxp.dxp-location-selector.search-wrapper .current-location li:before{content:\"\"}div.dxp.dxp-location-selector.search-wrapper .current-location-data{display:-ms-flexbox;display:flex}div.dxp.dxp-location-selector.search-wrapper .dxp-icon-current-location{position:relative;top:2px;margin-right:8px;width:16px;height:18px;display:block}\@media (max-width:767px){div.dxp.dxp-location-selector.search-wrapper .cta{padding-top:24px}}div.dxp.dxp-location-selector.search-wrapper[dir=rtl] .dxp-icon-globe{right:20px;left:auto}div.dxp.dxp-location-selector.search-wrapper[dir=rtl] .dxp-icon-caret-up,div.dxp.dxp-location-selector.search-wrapper[dir=rtl] .dxp-icon-close,div.dxp.dxp-location-selector.search-wrapper[dir=rtl] .dxp-icon.dxp-icon-caret-down{left:16px;right:auto}"}};export{h as dxp_location_selector};