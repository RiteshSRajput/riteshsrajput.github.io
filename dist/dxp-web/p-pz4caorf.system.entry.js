var __awaiter=this&&this.__awaiter||function(e,t,s,r){function i(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(t){n(t)}}function o(e){try{h(r["throw"](e))}catch(t){n(t)}}function h(e){e.done?s(e.value):i(e.value).then(a,o)}h((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var s={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(e){return function(t){return h([e,t])}}function h(a){if(r)throw new TypeError("Generator is already executing.");while(s)try{if(r=1,i&&(n=a[0]&2?i["return"]:a[0]?i["throw"]||((n=i["return"])&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;if(i=0,n)a=[a[0]&2,n.value];switch(a[0]){case 0:case 1:n=a;break;case 4:s.label++;return{value:a[1],done:false};case 5:s.label++;i=a[1];a=[0];continue;case 7:a=s.ops.pop();s.trys.pop();continue;default:if(!(n=s.trys,n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){s=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(a[0]===6&&s.label<n[1]){s.label=n[1];n=a;break}if(n&&s.label<n[2]){s.label=n[2];s.ops.push(a);break}if(n[2])s.ops.pop();s.trys.pop();continue}a=t.call(e,s)}catch(o){a=[6,o];i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,s=arguments.length;t<s;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<s;t++)for(var n=arguments[t],a=0,o=n.length;a<o;a++,i++)r[i]=n[a];return r};System.register(["./p-f4cc861d.system.js","./p-4b0c1219.system.js","./p-33b84f15.system.js"],(function(e){"use strict";var t,s,r,i,n,a,o,h;return{setters:[function(e){t=e.r;s=e.c;r=e.d;i=e.h;n=e.g},function(e){a=e.B},function(e){o=e.m;h=e.x}],execute:function(){var l="getSearchData()";var c=e("dxp_search_result",function(){function e(e){t(this,e);this.count=-1;this.highlightLines=[];this.pageStart=0;this.tempResultsData=[];this.highlighter=[];this.noResult="";this.responseData=[];this.searchValue="";this.cfq="";this.cfqLocale="";this.descriptionLength=200;this.titleLength=65;this.analyticsDataEmitter=s(this,"dxp_comp",7)}e.prototype.componentWillLoad=function(){this.base=new a(this,r);this.base.i18Init(r,"Search",o);if(this.searchApiUrl&&this.searchFl&&this.searchCollection&&this.highlightFields&&this.sortingField){this.cfqLocale=this.cfqLocale?this.cfqLocale:this.locale.toLowerCase().replace("_","-");this.searchEndPoint=""+(this.searchApiUrl+this.searchCollection);var e=this.highlightFields.split(",");var t="";for(var s=0,i=e;s<i.length;s++){var n=i[s];t=""+t+n+"_"+this.getPageLang(this.cfqLocale)+","}t=t.substring(0,t.length-1);this.searchConfig={rows:this.rows,start:this.start,hl:true,"hl.fl":t,"hl.fragsize":80,"hl.simple.pre":encodeURIComponent("<b>"),"hl.simple.post":encodeURIComponent("</b>"),"hl.snippets":8,"hl.usePhraseHighlighter":true,wt:"json"};if(this.promotionsData&&typeof this.promotionsData==="string"){this.promotionsData=JSON.parse(this.promotionsData)}if(this.promotionsKeywords){this.promotionsKeywordsArray=this.promotionsKeywords.split(",")}}};e.prototype.componentDidLoad=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(!(window.location.href.indexOf(this.searchParamKey)>-1))return[3,2];r.log.debug(this.element.tagName,"componentDidLoad()","Search Result Component-received the redirect page query");e=[];e=window.location.href.split(this.searchParamKey+"=");this.searchValue=decodeURIComponent(e[1].trim());return[4,this.setValue(this.searchValue)];case 1:t.sent();t.label=2;case 2:return[2]}}))}))};e.prototype.handleKeyUp=function(e){return __awaiter(this,void 0,void 0,(function(){var t,s,r,i,n,a,o,h,l,c;return __generator(this,(function(u){switch(u.label){case 0:t=e.target?e.target.activeElement:e.target;s=t.classList.contains("searchbox");r=t.classList.contains("dxp-icon-search");i=t.classList.contains("dxp-btn-secondary");n=t;a=e.keyCode;if(a===38||a===40){e.preventDefault()}if(!(a===13||a===32))return[3,7];if(!(r&&t.previousElementSibling.value.trim().length>=3))return[3,2];return[4,this.setValue(t.previousElementSibling.value)];case 1:u.sent();u.label=2;case 2:if(!n.classList.contains("list-element"))return[3,4];return[4,this.setValue(t.innerText)];case 3:u.sent();u.label=4;case 4:if(!(a===13&&s&&t.value.trim().length>=3))return[3,6];return[4,this.setValue(t.value)];case 5:u.sent();u.label=6;case 6:if(a===13&&i){h=t.closest(".sc-dxp-search-result").querySelectorAll(".result-listing");if(h){l=this.searchConfig["start"]+this.rows;this.tempElement=h[l-1].querySelector("a")}}u.label=7;case 7:if(a===40&&s){o=t.closest("div").querySelectorAll("li");if(o[0]){this.focusElement(o[0])}}if(a===38&&n.classList.contains("list-element")){o=t.closest("div").querySelectorAll("li");if(o[0]){c=this.getInputElement();this.focusElement(c)}}if(a===40&&t.closest(".dxp-dropdown-list")&&t.nextElementSibling){this.focusElement(t.nextElementSibling)}if(a===38&&t.closest(".dxp-dropdown-list")&&t.previousElementSibling){this.focusElement(t.previousElementSibling)}return[2]}}))}))};e.prototype.routingHandler=function(e){this.base.routingEventListener(e)};e.prototype.searchTermChangedHandler=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:r.log.debug(this.element.tagName,"searchTermChangedHandler()","Search Result Component-received the custom search term changed event: ",e.detail.searchTerm);this.searchValue=e.detail.searchTerm;return[4,this.setValue(this.searchValue)];case 1:t.sent();return[2]}}))}))};e.prototype.analyticSearchResult=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){e={di_comp_name:this.element.tagName,di_comp_searchfound:this.resultCount?"true":"false",di_comp_searchterm:this.searchValue,di_comp_searchresults:this.resultCount,di_comp_searchCollection:this.suggestCollection};this.analyticsDataEmitter.emit(e);r.log.info(this.element.tagName,"analyticSearchResult()",e);return[2]}))}))};e.prototype.setValue=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(s){this.searchValue=e;if(this.searchValue.trim().length){this.changeSearchResults(true).then((function(){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:r.log.info(this.element.tagName,"setValue()","in searchData");return[4,this.analyticSearchResult()];case 1:e.sent();return[2]}}))}))})).catch((function(e){return r.log.error(t.element.tagName,"setValue()","in searchData :"+e)}))}return[2]}))}))};e.prototype.changeSearchResults=function(e){return __awaiter(this,void 0,void 0,(function(){var t,s,i;var n=this;return __generator(this,(function(a){switch(a.label){case 0:this.element?this.element.querySelector(".dxp-list-container").classList.remove("dxp-show"):this.element.querySelector(".dxp-list-container").classList.remove("dxp-show");t=this.getInputElement();t.value=this.searchValue;this.tags?s='(url:"'+r.util.addEscapeCharacter(this.cfq+(this.cfqLocale.toLowerCase().trim()==="global"?"global":this.cfqLocale))+'" AND ('+this.sortingField+"_"+this.getPageLang(this.cfqLocale)+":("+r.util.addEscapeCharacter(this.searchValue.trim()).replace(new RegExp("\\ ","g")," AND ")+')) AND tags:"'+r.util.addEscapeCharacter(this.tags)+'")':s='(url:"'+r.util.addEscapeCharacter(this.cfq+(this.cfqLocale.toLowerCase().trim()==="global"?"global":this.cfqLocale))+'" AND ('+this.sortingField+"_"+this.getPageLang(this.cfqLocale)+":("+r.util.addEscapeCharacter(this.searchValue.trim()).replace(new RegExp("\\ ","g")," AND ")+")))";if(e){this.pageStart=0;this.searchConfig["start"]=0}this.searchConfig["fl"]=encodeURIComponent("termfreq("+this.sortingField+"_"+this.getPageLang(this.cfqLocale)+",'"+r.util.addEscapeCharacter(this.searchValue.trim())+"'),"+this.searchFl);this.searchConfig["sort"]=encodeURIComponent("termfreq("+this.sortingField+"_"+this.getPageLang(this.cfqLocale)+",'"+r.util.addEscapeCharacter(this.searchValue.trim())+"') desc,start_time asc");i=this;return[4,this.getSearchData(this.searchConfig,this.searchEndPoint,s).then((function(t){return __awaiter(n,void 0,void 0,(function(){var s;return __generator(this,(function(r){this.responseData=t;this.searchResults=this.responseData;if(this.searchResults&&this.searchResults.response){this.resultCount=this.responseData.response.numFound;s=this.highlightSearchKeyword(this.responseData.response.docs,this.responseData.highlighting);if(e){this.searchResults.response.docs=s;this.tempResultsData=this.searchResults.response.docs}else{this.searchResults.response.docs=__spreadArrays(this.tempResultsData,s);this.tempResultsData=this.searchResults.response.docs}}else{this.searchResults=[];this.resultCount=0}return[2]}))}))})).catch((function(e){r.log.error(n.element.tagName,"changeSearchResults()","Error in dxp-search fetch service: ",e)}))];case 1:i.responseData=a.sent();this.resultCount===0||this.searchResults&&this.searchResults.status===500?this.noResult="noresult":this.noResult="result";return[2]}}))}))};e.prototype.focusElement=function(e){e.focus()};e.prototype.getInputElement=function(){return this.element?this.element.querySelector(".searchbox"):this.element.querySelector(".searchbox")};e.prototype.getPageLang=function(e){e=e.toLowerCase().trim()==="global"?this.locale.toLowerCase().replace("_","-"):e;var t=e&&e.substring(0,2);if(t.indexOf("zh")===0||t.indexOf("ko")===0){t="cjk"}return t};e.prototype.getSearchData=function(e,t,s){var i=this;var n;n=e;if(t.indexOf("search")>-1){n["q"]=encodeURIComponent(s)}var a=Object.keys(n).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])})).join("&");var o={method:"POST",body:a,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}};try{if(h.request){h.request.abort()}return h.fetchRequest(t,o).then((function(e){r.log.debug(i.element.tagName,l,"xhr request success");return JSON.parse(e["response"])})).catch((function(e){r.log.debug(i.element.tagName,l,"xhr request cancelled/failed : "+JSON.stringify(e))}))}catch(c){r.log.error(this.element.tagName,l,"fetch failed",c)}};e.prototype.highlightSearchKeyword=function(e,t){var s;var i;var n;var a;var o="...";for(var h=0,l=e;h<l.length;h++){var c=l[h];if(c.title){var u=c.id;i="";s="";var p="_"+this.getPageLang(this.cfqLocale);n="content"+(this.getPageLang(this.cfqLocale)?p:"");a="title"+(this.getPageLang(this.cfqLocale)?p:"");if(t[u][a]){for(var g=0,d=t[u][a];g<d.length;g++){var f=d[g];i=i+f}}else{i=c.title}if(i.length>this.titleLength){i=i.substring(0,this.titleLength);i=i.substring(0,i.lastIndexOf(" "))+" "+o}if(t[u][n]){s="...";for(var m=0,v=t[u][n];m<v.length;m++){var y=v[m];s=s+" "+y+" "+o+" "}}else if(c.description){s=c.description}if(s.length>this.descriptionLength){s=s.substring(0,this.descriptionLength);s=s.substring(0,s.lastIndexOf(" "));if(s.lastIndexOf("... ")!==s.length-5&&s.lastIndexOf(" ...")!==s.length-5&&s.lastIndexOf("...")!==s.length-3){s=s+" "+o}}if(i){c.title=i;s?c.description=s:c.description=r.i18n.t("Search:skipContent")}}else{this.resultCount=0;e.length=0}}return e};e.prototype.renderSearchResults=function(e){return e.map((function(e){return i("div",{class:"result-listing"},i("div",null,i("a",{href:""+e.url,class:"column-item-link",innerHTML:e.title})),i("div",{class:"data-description",innerHTML:e.description}))}))};e.prototype.scrollToTop=function(){var e=this.getInputElement();e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})};e.prototype.viewMore=function(){var e=this;this.pageStart=this.pageStart+1;this.searchConfig["start"]=this.rows*this.pageStart;this.changeSearchResults(false).then((function(){return r.log.info(e.element.tagName,"viewMore()","in searchData")})).catch((function(t){return r.log.error(e.element.tagName,"viewMore()","in searchData :"+t)}));if(this.tempElement){this.focusElement(this.tempElement)}};e.prototype.render=function(){var e=this;r.log.debug(this.element.tagName,"render()","in dxp-search-result render() : "+"DEVELOPMENT");if(!this.searchConfig){r.log.debug(this.element.tagName,"render()","component not rendered : check suggester and search config object");return}var t=i("span",null,i("link",{rel:"stylesheet",href:""}),this.theme&&i("link",{rel:"stylesheet",href:""}),this.theme&&i("link",{rel:"stylesheet",href:r.config.get("DXP_STYLE_BASE_URL")+"/themes/"+this.theme+"/dxp-search-result.min.css"}),this.dtmUrl&&i("script",{src:this.dtmUrl}));return i("div",{class:this.base.componentClass(),dir:this.dir,"data-theme":this.theme},t,i("div",{id:"search-results",class:"sc-dxp-search-result search-results",role:"application"},i("div",{class:"dxp-row"},i("div",{class:"sc-dxp-search-result dxp-col-12 search-container"},i("dxp-searchbox",{"suggest-collection":this.suggestCollection,cfq:this.cfq,placeholder:this.placeholder,"suggest-api-url":this.suggestApiUrl,"cfq-locale":this.cfqLocale,"suggest-count":this.suggestCount,"suggest-dictionary":this.suggestDictionary,"no-result-flag":this.noResult,"searched-text":this.searchValue,"searched-term":this.searchValue,"result-count":this.resultCount,"error-text":this.errorMessage}),i("div",{class:"sc-dxp-search-result dxp-col-lg-8 dxp-col-md-12 dxp-col-12 dxp-p-0"},this.showPromotions&&this.promotionsData&&this.promotionsKeywordsArray.some((function(t){return e.searchValue.toLowerCase()===t.toLowerCase()}))&&this.searchResults&&this.searchResults.response&&this.renderSearchResults(this.promotionsData),this.searchResults&&this.searchResults.response&&this.searchResults.response.docs&&this.renderSearchResults(this.searchResults.response.docs)))),this.searchResults&&this.searchResults.response&&this.searchResults.response.docs.length!==this.resultCount&&i("div",{class:"dxp-col-12 view-more-button"},i("button",{"aria-label":this.viewMoreText,class:"dxp-btn dxp-btn-secondary dxp-btn-lg",onClick:function(){return e.viewMore()}},this.viewMoreText))))};Object.defineProperty(e.prototype,"element",{get:function(){return n(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return"div.dxp.dxp-search-result .search-results{padding-top:5rem}div.dxp.dxp-search-result .search-results .no-result-message{list-style-type:disc;padding-left:.75rem;padding-top:.625rem}div.dxp.dxp-search-result .search-results .view-more-button{position:relative;padding:4rem 0 6.19rem 0}div.dxp.dxp-search-result .search-results .result-count-align{margin-bottom:1.625rem}div.dxp.dxp-search-result .search-results .dxp-icon-close{position:absolute;top:.9375rem;right:.9375rem;margin:0;padding:0;cursor:pointer}div.dxp.dxp-search-result .search-results .wrapper{position:relative}div.dxp.dxp-search-result .search-results .dxp-dropdown-list li{height:auto;line-height:normal}div.dxp.dxp-search-result .search-results .dxp-dropdown-list li:after{display:none}div.dxp.dxp-search-result .search-results .searchbox{height:2.5rem;padding:.68rem 2.2rem .5rem 2.5rem;border-radius:2.1875rem;margin-bottom:2.375rem}div.dxp.dxp-search-result .search-results .searchbox+.dxp-icon-search{position:absolute;cursor:pointer;left:.875rem;top:.75rem}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container{border:0;background:none;margin-top:.625rem;position:relative;top:-.0625rem}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container.dxp-show{border-top:none}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container ul{max-height:15rem;overflow-y:auto}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container li{margin-bottom:.2188rem;text-align:left;padding-left:2.5rem}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container li:after{height:3.0625rem;left:1%}div.dxp.dxp-search-result .search-results .search-terms{text-transform:uppercase;letter-spacing:.0625rem;margin-top:3.5rem}div.dxp.dxp-search-result .search-results .result-listing{padding:1.125rem 0}div.dxp.dxp-search-result .search-results .result-listing .column-item-link{margin-bottom:.1875rem;margin-top:inherit}div.dxp.dxp-search-result .search-results .result-listing .column-item-link:after,div.dxp.dxp-search-result .search-results .result-listing .column-item-link:before{background:none}div.dxp.dxp-search-result .search-results .search-box-wrapper{position:relative}div.dxp.dxp-search-result[dir=rtl] .search-results .searchbox{padding:.68rem 2.2rem .5rem 3.125rem}div.dxp.dxp-search-result[dir=rtl] .search-results .searchbox+.dxp-icon-search{right:.75rem}div.dxp.dxp-search-result[dir=rtl] .search-results .searchbox~.dxp-list-container li{padding-right:2.125rem;text-align:right}div.dxp.dxp-search-result[dir=rtl] .search-results .dxp-icon-close{left:.9375rem;right:auto}"},enumerable:true,configurable:true});return e}())}}}));