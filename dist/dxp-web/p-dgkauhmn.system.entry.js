var __awaiter=this&&this.__awaiter||function(t,e,s,r){function a(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,i){function n(t){try{l(r.next(t))}catch(e){i(e)}}function o(t){try{l(r["throw"](t))}catch(e){i(e)}}function l(t){t.done?s(t.value):a(t.value).then(n,o)}l((r=r.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,n;return n={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(n[Symbol.iterator]=function(){return this}),n;function o(t){return function(e){return l([t,e])}}function l(n){if(r)throw new TypeError("Generator is already executing.");while(s)try{if(r=1,a&&(i=n[0]&2?a["return"]:n[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;if(a=0,i)n=[n[0]&2,i.value];switch(n[0]){case 0:case 1:i=n;break;case 4:s.label++;return{value:n[1],done:false};case 5:s.label++;a=n[1];n=[0];continue;case 7:n=s.ops.pop();s.trys.pop();continue;default:if(!(i=s.trys,i=i.length>0&&i[i.length-1])&&(n[0]===6||n[0]===2)){s=0;continue}if(n[0]===3&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(n[0]===6&&s.label<i[1]){s.label=i[1];i=n;break}if(i&&s.label<i[2]){s.label=i[2];s.ops.push(n);break}if(i[2])s.ops.pop();s.trys.pop();continue}n=e.call(t,s)}catch(o){n=[6,o];a=0}finally{r=i=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;for(var r=Array(t),a=0,e=0;e<s;e++)for(var i=arguments[e],n=0,o=i.length;n<o;n++,a++)r[a]=i[n];return r};System.register(["./p-f4cc861d.system.js","./p-4b0c1219.system.js"],(function(t){"use strict";var e,s,r,a,i,n;return{setters:[function(t){e=t.r;s=t.c;r=t.d;a=t.h;i=t.g},function(t){n=t.B}],execute:function(){var o={en:{listText:"Select search item from list",selectedItem:"Current selected {{item}}",close:"Press delete or backspace to remove selected item",closeText:"Close"},es:{listText:"Seleccione el elemento de bÃºsqueda de la lista",selectedItem:"Seleccionado actualmente {{item}}",close:"Presione eliminar o retroceder para eliminar el elemento seleccionado",closeText:"Cerrar"}};var l;var u=new XMLHttpRequest;var h=function(t,e){return new Promise((function(s,r){u.onreadystatechange=function(){if(u.readyState!==4){return}if(u.status>=200&&u.status<300){s(u)}else{r({status:u.status,statusText:u.statusText})}};u.onerror=function(){r({status:u.status,statusText:u.statusText})};u.open(e.method,t,true);if(e.headers){Object.keys(e.headers).forEach((function(t){u.setRequestHeader(t,e.headers[t])}))}u.send(e.body)}))};l={request:u,fetchRequest:h};var c=l;var p="dxp-dropdown-list-item";var g="tag items changed event emit: ";var f=t("dxp_tag_input",function(){function t(t){e(this,t);this.keysArray=[];this.responseData=[];this.searchValue="";this.showSearchBoxList=false;this.suggestData=[];this.tagsArray=[];this.tagsTempArray=[];this.tagItemsChanged=s(this,"tagItemsChanged",7)}t.prototype.componentWillLoad=function(){this.base=new n(this,r);this.base.i18Init(r,"TagInput",o);if(this.keysToDisplay){this.keysArray=this.keysToDisplay.split(",")}if(this.tagsData&&typeof this.tagsData==="string"){this.tagsData=JSON.parse(this.tagsData)}};t.prototype.componentDidUpdate=function(){var t=this.element?this.element.querySelector(".dxp-list-container"):this.element.querySelector(".dxp-list-container");if(this.clientHeight()>=66){t["style"].setProperty("top","68px")}else if(this.clientHeight()===64){t["style"].setProperty("top","66px")}else if(this.clientHeight()<=40){t["style"].setProperty("top","42px")}};t.prototype.clickEvent=function(t){if(!t.target.classList.contains("dxp-list-container")){this.showSearchBoxList=false}};t.prototype.handleKeyUp=function(t){var e=t.target?t.target.activeElement:t.target;var s=e.classList.contains("searchbox");var r=e.classList.contains(p);var a=e.nextElementSibling;var i=e.previousElementSibling;var n=t.keyCode;var o=e.closest("div");var l=o.nextElementSibling;var u=o.previousElementSibling;var h=e.classList.contains("tags");if(n===8){this.OnBackspaceKey(e,s,h)}else if(n===40){this.onDownArrowKey(t,s,l,r,a)}else if(n===38){this.onUpArrowKey(t,u,r,i)}else if(n===13||n===32){this.OnEnterAndSpaceKey(e,r)}else if(n===37){this.onLeftArrowKey(e,s,h,i)}else if(n===39){this.onRightArrowKey(h,a)}else if(n===46){this.onDeleteKey(e,h)}};t.prototype.routingHandler=function(t){this.base.routingEventListener(t)};t.prototype.clearItem=function(t){var e=this.tagsArray;var s=e.filter((function(e){return e.id!==t}));this.tagsArray=s;this.showSearchBoxList=false;this.focusInput();this.tagItemsChanged.emit({tagItems:this.tagsArray});r.log.debug(this.element.tagName,"clearItem()",g,this.tagsArray)};t.prototype.clientHeight=function(){var t=this.element?this.element.querySelector(".tag-div"):this.element.querySelector(".tag-div");return t.clientHeight};t.prototype.filterTagsData=function(t){var e=this;var s=t.toLowerCase();return this.responseData[this.dataKey].filter((function(t){return e.keysArray.some((function(e){return t[e].toLowerCase().includes(s)}))}))};t.prototype.focusElement=function(t){t.focus()};t.prototype.focusInput=function(){var t=this.getInputElement();if(t){t.focus();t.style.minWidth="auto"}};t.prototype.getData=function(t,e){return __awaiter(this,void 0,void 0,(function(){var s,a;var i=this;return __generator(this,(function(n){s={method:"GET",headers:this.apiHeaders?JSON.parse(this.apiHeaders):{"Content-Type":"application/json"}};try{if(c.request){c.request.abort()}a=c.fetchRequest(t+e,s).then((function(t){r.log.debug(i.element.tagName,"getData()","xhr request success");return JSON.parse(t["response"])})).catch((function(t){r.log.debug(i.element.tagName,"getData()","xhr request cancelled/failed : "+JSON.stringify(t))}));this.responseData=a;return[2,this.responseData]}catch(o){r.log.error(this.element.tagName,"getData()","fetch failed",o)}return[2]}))}))};t.prototype.getInputElement=function(){return this.element?this.element.querySelector(".searchbox"):this.element.querySelector(".searchbox")};t.prototype.getSearchListElement=function(){return this.element?this.element.querySelector("."+p):this.element.getElementsByClassName(p)[0]};t.prototype.groupDataByField=function(){var t=this;this.suggestData=this.suggestData.reduce((function(e,s){e[s[t.groupByField]]=e[s[t.groupByField]]||[];e[s[t.groupByField]].push(s);return e}),Object.create({}));if(this.tagsArray.length){var e=[];this.tagsArray.forEach((function(t){return e.push(t.id)}));Object.keys(this.suggestData).forEach((function(s){t.suggestData[s]=t.suggestData[s].filter((function(t){return e.indexOf(t.id)===-1}))}))}};t.prototype.groupSearchSuggestData=function(){if(this.tagsArray.length){var t=[];this.tagsArray.forEach((function(e){return t.push(e.id)}));this.suggestData=this.suggestData.filter((function(e){return t.indexOf(e.id)===-1}))}};t.prototype.handleChange=function(t){return __awaiter(this,void 0,void 0,(function(){var e,s,a;return __generator(this,(function(i){switch(i.label){case 0:e=t.trim();this.searchValue=t.trim();this.suggestData=[];this.responseData=[];if(!(e.length>=3))return[3,4];if(!this.apiUrl)return[3,2];a=this;return[4,this.getData(this.apiUrl,e)];case 1:s=a.responseData=i.sent();return[3,3];case 2:s=this.responseData=this.tagsData;i.label=3;case 3:s;if(this.responseData){this.responseData=this.apiUrl?this.responseData[this.dataKey]:this.filterTagsData(e);this.suggestData=this.responseData;this.suggestData=r.util.removeDuplicates(this.suggestData);if(this.groupByField){this.groupDataByField()}else{this.groupSearchSuggestData()}}this.responseData&&this.responseData.length>0?this.showSearchBoxList=true:this.showSearchBoxList=false;return[3,5];case 4:this.showSearchBoxList=false;i.label=5;case 5:return[2]}}))}))};t.prototype.isSuggestData=function(){var t=false;for(var e=0,s=Object.keys(this.suggestData);e<s.length;e++){var r=s[e];if(this.suggestData[r].length){t=true}}return t};t.prototype.OnBackspaceKey=function(t,e,s){if(e&&this.tagsArray.length&&t.selectionStart===0){this.tagsTempArray=this.tagsArray.pop();this.tagItemsChanged.emit({tagItems:this.tagsArray});r.log.debug(this.element.tagName,"handleKeyUp()",g,this.tagsArray)}else if(s){var a=t.id;this.clearItem(a)}};t.prototype.onDeleteKey=function(t,e){if(e){var s=t.id;this.clearItem(s)}};t.prototype.onDownArrowKey=function(t,e,s,r,a){t.preventDefault();if(e){var i=s.querySelector("li");if(i){this.focusElement(i)}}else if(r){if(a&&!e){this.focusElement(a)}else if(s&&!a&&!e){var i=s.querySelector("li");if(i){this.focusElement(i)}}}};t.prototype.OnEnterAndSpaceKey=function(t,e){if(e){{t.click()}}};t.prototype.onLeftArrowKey=function(t,e,s,r){if(e&&t.selectionStart===0){if(r&&r.nodeName==="SPAN"){this.showSearchBoxList=false;this.focusElement(r)}}else if(s){if(r&&r.nodeName==="SPAN"){this.focusElement(r)}}};t.prototype.onListItemSelection=function(t){var e=this.getInputElement();e.value="";this.showSearchBoxList=false;this.tagsArray=__spreadArrays(this.tagsArray,[t]);this.tagItemsChanged.emit({tagItems:this.tagsArray});r.log.debug(this.element.tagName,"onListItemSelection()",g,this.tagsArray)};t.prototype.onRightArrowKey=function(t,e){if(t){if(e&&e.nodeName==="SPAN"){this.focusElement(e)}else if(e&&e.nodeName==="INPUT"){this.focusElement(e)}}};t.prototype.onTextInput=function(t){var e=this;t.target.style.minWidth=(t.target.value.length+1)*7+"px";this.handleChange(t.target.value).then((function(){return r.log.info(e.element.tagName,"onTextInput()","in handleChange")})).catch((function(t){return r.log.error(e.element.tagName,"onTextInput()","in handleChange :"+t)}))};t.prototype.onUpArrowKey=function(t,e,s,r){t.preventDefault();if(s&&r&&r.nodeName!=="SPAN"){this.focusElement(r)}else if(e&&s&&r.nodeName==="SPAN"){var a=e.querySelectorAll("li");this.focusElement(a[a.length-1])}};t.prototype.renderSuggestionData=function(t){var e=this;return a("div",null,this.suggestData[t].length?a("span",{class:"title-font list-element "+p},t):undefined,this.suggestData[t].map((function(t){return a("li",{tabindex:"0",class:"list-element "+p,"aria-label":r.i18n.t("TagInput:selectedItem",{item:t[e.keysArray[0]]}),onClick:function(){return e.selectSuggestion(t)}},a("span",null,t[e.keysArray[0]]),e.keysArray[1]&&a("span",{class:"subtitle"},t[e.keysArray[1]]))})))};t.prototype.selectSuggestion=function(t){this.onListItemSelection(t);this.focusInput()};t.prototype.render=function(){var t=this;r.log.debug(this.element.tagName,"render()","in dxp-tag-input render() : "+"DEVELOPMENT");if(!this.apiUrl&&!this.tagsData||!this.keysToDisplay||!this.dataKey){r.log.debug(this.element.tagName,"render()","component not rendered : check mandatory fields");return}var e=[a("link",{rel:"stylesheet",href:""}),[this.theme&&a("link",{rel:"stylesheet",href:""})],[this.theme&&a("link",{rel:"stylesheet",href:r.config.get("DXP_STYLE_BASE_URL")+"/themes/"+this.theme+"/dxp-tag-input.min.css"})],[this.theme&&a("link",{rel:"stylesheet",href:r.config.get("DXP_STYLE_BASE_URL")+"/themes/"+this.theme+"/dxp-input.min.css"})]];var s=(this.suggestData.length||this.isSuggestData())&&this.showSearchBoxList&&this.searchValue.length>=3;return a("div",{class:this.base.componentClass()+" search-container ",dir:this.dir,"data-theme":this.theme},e,a("div",{class:"tag-div",onClick:function(){return t.focusInput()}},this.tagsArray.map((function(e){return a("span",{class:"tags",tabindex:"0",id:e.id},e[t.keysArray[0]]," ",a("a",{class:"dxp-icon dxp-icon-small dxp-icon-close icon-close",title:r.i18n.t("TagInput:closeText"),"aria-label":r.i18n.t("TagInput:close"),onClick:function(){return t.clearItem(e.id)}}))})),a("input",{type:"text","aria-haspopup":"listbox",name:"searchbox","aria-label":this.placeholder,id:"tagInput",class:"dxp-form-control searchbox ",placeholder:!this.tagsArray.length&&this.placeholder,onInput:function(e){t.onTextInput(e)}})),a("div",{class:"dxp-list-container "+(s?"dxp-block":"")},a("ul",{class:"dxp-dropdown-list",id:"transactioncurrency","aria-label":r.i18n.t("TagInput:listText")},this.groupByField?Object.keys(this.suggestData).map((function(e){return t.renderSuggestionData(e)})):a("div",null,this.suggestData.map((function(e){return a("li",{tabindex:"0",class:"list-element "+p,"aria-label":r.i18n.t("TagInput:selectedItem",{item:e[t.keysArray[0]]}),onClick:function(){return t.selectSuggestion(e)}},a("span",{class:"title-font"},e[t.keysArray[0]]),t.keysArray[1]&&a("span",{class:"subtitle"},e[t.keysArray[1]]))}))))))};Object.defineProperty(t.prototype,"element",{get:function(){return i(this)},enumerable:true,configurable:true});Object.defineProperty(t,"style",{get:function(){return"div.dxp.dxp-tag-input{position:relative}div.dxp.dxp-tag-input input.searchbox{padding:0;height:auto;width:auto;display:inline-block;border:none}div.dxp.dxp-tag-input input.searchbox:focus{-webkit-box-shadow:none;box-shadow:none}div.dxp.dxp-tag-input .tag-div{min-height:40px;max-height:68px;border-radius:4px;padding:7px 10px;overflow-y:auto;overflow-x:hidden}div.dxp.dxp-tag-input .tag-div .tag-block{display:inline-block}div.dxp.dxp-tag-input .tags{padding:3px 30px 3px 11px;border-radius:19.5px;position:relative;display:inline-block;margin-right:5px}div.dxp.dxp-tag-input .tags .icon-close{position:absolute;top:7px;right:5px;cursor:pointer}div.dxp.dxp-tag-input .dxp-list-container{border-radius:5px;border:none;margin:auto;top:42px;left:0;right:0}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list{margin:0;padding:8px 0 20px 0}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list .dxp-dropdown-list-item span{display:block;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list div>span:first-of-type{padding-left:17px;cursor:default}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list li{height:auto;line-height:normal;padding:4.5px 34px 7.5px 19px;margin-top:6px}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list li:after{border-top:none;border-bottom:none}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list .group-title{padding-left:17px;cursor:default}div.dxp.dxp-tag-input[dir=rtl] .dxp-list-container .dxp-dropdown-list li{padding:4px 19px 5px 34px}div.dxp.dxp-tag-input[dir=rtl] .dxp-list-container .dxp-dropdown-list div>span:first-of-type{padding-left:0;padding-right:17px;cursor:default}div.dxp.dxp-tag-input[dir=rtl] .tags{padding:3px 11px 3px 30px}div.dxp.dxp-tag-input[dir=rtl] .tags .icon-close{right:auto;left:5px}"},enumerable:true,configurable:true});return t}())}}}));