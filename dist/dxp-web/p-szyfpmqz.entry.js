import{r as t,c as s,d as i,g as e}from"./p-8188e849.js";const n=class{constructor(i){t(this,i),this.initialAssignmentDone=!1,this.srcFailed=s(this,"srcFailed",7),this.srcLoaded=s(this,"srcLoaded",7)}async srcChanged(){if(this.srcAssigned)return i.log.debug(this.container.tagName,"isCustomElement()","cannot change src after initially assigned"),void this.srcFailed.emit({src:this.src});await this.fetchContent()}async componentWillLoad(){this.src&&await this.fetchContent(),this.initObserver()}applyAttributes(t,s){const e={};return Object.keys(s).forEach(n=>{if(n.startsWith("dxp-"))if(Array.isArray(s[n]))s[n].forEach(s=>{const i=document.createElement(n);t.appendChild(i),this.applyAttributes(i,s)});else{let i="";if(n.indexOf("@")>0){i=n.split("@")[1],n=n.split("@")[0];const e=document.createElement(n);e.setAttribute("content-id",i),t.appendChild(e),this.applyAttributes(e,s[`${n}@${i}`])}else{const e=document.createElement(n);e.setAttribute("content-id",i),t.appendChild(e),this.applyAttributes(e,s[n])}}else Array.isArray(s[n])||"object"==typeof s[n]?e[n]=s[n]:t.setAttribute(this.formatAttributeName(n),s[n]);"class"===n&&!t.classList.contains("hydrated")&&(t=>customElements?!customElements.get(t.tagName.toLowerCase()):(i.log.error(t.tagName,"isCustomElement()","expected customElements API"),!1))(t)&&t.classList.add("hydrated")}),Object.assign(t,e)}assignContent(){"object"==typeof this.data?(i.log.trace(this.container.tagName,"assignContent()","dxp-container: assigning content"),Object.keys(this.data).forEach(t=>{t.toLowerCase()===this.containerId.toLowerCase()&&Object.keys(this.data[t].components).forEach(s=>{const i=s.split("@");Array.from(this.container.querySelectorAll(`[content-id=${i[1]}]`)).forEach(i=>{this.applyAttributes(i,this.data[t].components[s])})})}),this.initialAssignmentDone=!0,this.srcLoaded.emit({src:this.src})):i.log.error(this.container.tagName,"assignContent()","cms data is not object")}async fetchContent(){this.srcAssigned=!0;try{this.data=await i.api(this.src),this.assignContent()}catch(t){i.log.error(this.container.tagName,"fetchContent()",`cms fetch failed for ${this.src}`,t),this.srcFailed.emit({src:this.src})}}formatAttributeName(t){return t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}initObserver(){new MutationObserver(t=>{t.forEach(t=>{Array.from(t.addedNodes).forEach(t=>{if(this.initialAssignmentDone&&t.nodeType===Node.ELEMENT_NODE){const s=t.getAttribute("content-id");s&&this.data[s]&&this.applyAttributes(t,this.data[s])}})})}).observe(this.container,{childList:!0,subtree:!0})}render(){return""}get container(){return e(this)}static get watchers(){return{src:["srcChanged"]}}};export{n as dxp_container};