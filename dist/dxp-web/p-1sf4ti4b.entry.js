import{r as t,c as s,d as i,h as e,g as h}from"./p-8188e849.js";import{B as n}from"./p-16d6f0ca.js";const a={en:{listText:"Select search item from list",selectedItem:"Current selected {{item}}",close:"Press delete or backspace to remove selected item",closeText:"Close"},es:{listText:"Seleccione el elemento de bÃºsqueda de la lista",selectedItem:"Seleccionado actualmente {{item}}",close:"Presione eliminar o retroceder para eliminar el elemento seleccionado",closeText:"Cerrar"}};let l;const o=new XMLHttpRequest,c=l={request:o,fetchRequest:(t,s)=>new Promise((i,e)=>{o.onreadystatechange=()=>{4===o.readyState&&(o.status>=200&&o.status<300?i(o):e({status:o.status,statusText:o.statusText}))},o.onerror=()=>{e({status:o.status,statusText:o.statusText})},o.open(s.method,t,!0),s.headers&&Object.keys(s.headers).forEach(t=>{o.setRequestHeader(t,s.headers[t])}),o.send(s.body)})},r="dxp-dropdown-list-item",d="tag items changed event emit: ",p=class{constructor(i){t(this,i),this.keysArray=[],this.responseData=[],this.searchValue="",this.showSearchBoxList=!1,this.suggestData=[],this.tagsArray=[],this.tagsTempArray=[],this.tagItemsChanged=s(this,"tagItemsChanged",7)}componentWillLoad(){this.base=new n(this,i),this.base.i18Init(i,"TagInput",a),this.keysToDisplay&&(this.keysArray=this.keysToDisplay.split(",")),this.tagsData&&"string"==typeof this.tagsData&&(this.tagsData=JSON.parse(this.tagsData))}componentDidUpdate(){const t=this.element.querySelector(".dxp-list-container");this.clientHeight()>=66?t.style.setProperty("top","68px"):64===this.clientHeight()?t.style.setProperty("top","66px"):this.clientHeight()<=40&&t.style.setProperty("top","42px")}clickEvent(t){t.target.classList.contains("dxp-list-container")||(this.showSearchBoxList=!1)}handleKeyUp(t){const s=t.target?t.target.activeElement:t.target,i=s.classList.contains("searchbox"),e=s.classList.contains(r),h=s.nextElementSibling,n=s.previousElementSibling,a=t.keyCode,l=s.closest("div"),o=l.nextElementSibling,c=l.previousElementSibling,d=s.classList.contains("tags");8===a?this.OnBackspaceKey(s,i,d):40===a?this.onDownArrowKey(t,i,o,e,h):38===a?this.onUpArrowKey(t,c,e,n):13===a||32===a?this.OnEnterAndSpaceKey(s,e):37===a?this.onLeftArrowKey(s,i,d,n):39===a?this.onRightArrowKey(d,h):46===a&&this.onDeleteKey(s,d)}routingHandler(t){this.base.routingEventListener(t)}clearItem(t){const s=this.tagsArray.filter(s=>s.id!==t);this.tagsArray=s,this.showSearchBoxList=!1,this.focusInput(),this.tagItemsChanged.emit({tagItems:this.tagsArray}),i.log.debug(this.element.tagName,"clearItem()",d,this.tagsArray)}clientHeight(){return this.element.querySelector(".tag-div").clientHeight}filterTagsData(t){const s=t.toLowerCase();return this.responseData[this.dataKey].filter(t=>this.keysArray.some(i=>t[i].toLowerCase().includes(s)))}focusElement(t){t.focus()}focusInput(){const t=this.getInputElement();t&&(t.focus(),t.style.minWidth="auto")}async getData(t,s){const e={method:"GET",headers:this.apiHeaders?JSON.parse(this.apiHeaders):{"Content-Type":"application/json"}};try{c.request&&c.request.abort();const h=c.fetchRequest(t+s,e).then(t=>(i.log.debug(this.element.tagName,"getData()","xhr request success"),JSON.parse(t.response))).catch(t=>{i.log.debug(this.element.tagName,"getData()",`xhr request cancelled/failed : ${JSON.stringify(t)}`)});return this.responseData=h,this.responseData}catch(h){i.log.error(this.element.tagName,"getData()","fetch failed",h)}}getInputElement(){return this.element.querySelector(".searchbox")}getSearchListElement(){return this.element?this.element.querySelector(`.${r}`):this.element.getElementsByClassName(r)[0]}groupDataByField(){if(this.suggestData=this.suggestData.reduce((t,s)=>(t[s[this.groupByField]]=t[s[this.groupByField]]||[],t[s[this.groupByField]].push(s),t),Object.create({})),this.tagsArray.length){const t=[];this.tagsArray.forEach(s=>t.push(s.id)),Object.keys(this.suggestData).forEach(s=>{this.suggestData[s]=this.suggestData[s].filter(s=>-1===t.indexOf(s.id))})}}groupSearchSuggestData(){if(this.tagsArray.length){const t=[];this.tagsArray.forEach(s=>t.push(s.id)),this.suggestData=this.suggestData.filter(s=>-1===t.indexOf(s.id))}}async handleChange(t){const s=t.trim();this.searchValue=t.trim(),this.suggestData=[],this.responseData=[],s.length>=3?(this.responseData=this.apiUrl?await this.getData(this.apiUrl,s):this.tagsData,this.responseData&&(this.responseData=this.apiUrl?this.responseData[this.dataKey]:this.filterTagsData(s),this.suggestData=this.responseData,this.suggestData=i.util.removeDuplicates(this.suggestData),this.groupByField?this.groupDataByField():this.groupSearchSuggestData()),this.showSearchBoxList=!!(this.responseData&&this.responseData.length>0)):this.showSearchBoxList=!1}isSuggestData(){let t=!1;for(const s of Object.keys(this.suggestData))this.suggestData[s].length&&(t=!0);return t}OnBackspaceKey(t,s,e){s&&this.tagsArray.length&&0===t.selectionStart?(this.tagsTempArray=this.tagsArray.pop(),this.tagItemsChanged.emit({tagItems:this.tagsArray}),i.log.debug(this.element.tagName,"handleKeyUp()",d,this.tagsArray)):e&&this.clearItem(t.id)}onDeleteKey(t,s){s&&this.clearItem(t.id)}onDownArrowKey(t,s,i,e,h){if(t.preventDefault(),s){const t=i.querySelector("li");t&&this.focusElement(t)}else if(e)if(h&&!s)this.focusElement(h);else if(i&&!h&&!s){const t=i.querySelector("li");t&&this.focusElement(t)}}OnEnterAndSpaceKey(t,s){s&&t.click()}onLeftArrowKey(t,s,i,e){s&&0===t.selectionStart?e&&"SPAN"===e.nodeName&&(this.showSearchBoxList=!1,this.focusElement(e)):i&&e&&"SPAN"===e.nodeName&&this.focusElement(e)}onListItemSelection(t){this.getInputElement().value="",this.showSearchBoxList=!1,this.tagsArray=[...this.tagsArray,t],this.tagItemsChanged.emit({tagItems:this.tagsArray}),i.log.debug(this.element.tagName,"onListItemSelection()",d,this.tagsArray)}onRightArrowKey(t,s){t&&(s&&"SPAN"===s.nodeName?this.focusElement(s):s&&"INPUT"===s.nodeName&&this.focusElement(s))}onTextInput(t){t.target.style.minWidth=`${7*(t.target.value.length+1)}px`,this.handleChange(t.target.value).then(()=>i.log.info(this.element.tagName,"onTextInput()","in handleChange")).catch(t=>i.log.error(this.element.tagName,"onTextInput()",`in handleChange :${t}`))}onUpArrowKey(t,s,i,e){if(t.preventDefault(),i&&e&&"SPAN"!==e.nodeName)this.focusElement(e);else if(s&&i&&"SPAN"===e.nodeName){const t=s.querySelectorAll("li");this.focusElement(t[t.length-1])}}renderSuggestionData(t){return e("div",null,this.suggestData[t].length?e("span",{class:`title-font list-element ${r}`},t):void 0,this.suggestData[t].map(t=>e("li",{tabindex:"0",class:`list-element ${r}`,"aria-label":i.i18n.t("TagInput:selectedItem",{item:t[this.keysArray[0]]}),onClick:()=>this.selectSuggestion(t)},e("span",null,t[this.keysArray[0]]),this.keysArray[1]&&e("span",{class:"subtitle"},t[this.keysArray[1]]))))}selectSuggestion(t){this.onListItemSelection(t),this.focusInput()}render(){if(i.log.debug(this.element.tagName,"render()","in dxp-tag-input render() : DEVELOPMENT"),!this.apiUrl&&!this.tagsData||!this.keysToDisplay||!this.dataKey)return void i.log.debug(this.element.tagName,"render()","component not rendered : check mandatory fields");const t=[e("link",{rel:"stylesheet",href:""}),[this.theme&&e("link",{rel:"stylesheet",href:""})],[this.theme&&e("link",{rel:"stylesheet",href:`${i.config.get("DXP_STYLE_BASE_URL")}/themes/${this.theme}/dxp-tag-input.min.css`})],[this.theme&&e("link",{rel:"stylesheet",href:`${i.config.get("DXP_STYLE_BASE_URL")}/themes/${this.theme}/dxp-input.min.css`})]],s=(this.suggestData.length||this.isSuggestData())&&this.showSearchBoxList&&this.searchValue.length>=3;return e("div",{class:`${this.base.componentClass()} search-container `,dir:this.dir,"data-theme":this.theme},t,e("div",{class:"tag-div",onClick:()=>this.focusInput()},this.tagsArray.map(t=>e("span",{class:"tags",tabindex:"0",id:t.id},t[this.keysArray[0]]," ",e("a",{class:"dxp-icon dxp-icon-small dxp-icon-close icon-close",title:i.i18n.t("TagInput:closeText"),"aria-label":i.i18n.t("TagInput:close"),onClick:()=>this.clearItem(t.id)}))),e("input",{type:"text","aria-haspopup":"listbox",name:"searchbox","aria-label":this.placeholder,id:"tagInput",class:"dxp-form-control searchbox ",placeholder:!this.tagsArray.length&&this.placeholder,onInput:t=>{this.onTextInput(t)}})),e("div",{class:`dxp-list-container ${s?"dxp-block":""}`},e("ul",{class:"dxp-dropdown-list",id:"transactioncurrency","aria-label":i.i18n.t("TagInput:listText")},this.groupByField?Object.keys(this.suggestData).map(t=>this.renderSuggestionData(t)):e("div",null,this.suggestData.map(t=>e("li",{tabindex:"0",class:`list-element ${r}`,"aria-label":i.i18n.t("TagInput:selectedItem",{item:t[this.keysArray[0]]}),onClick:()=>this.selectSuggestion(t)},e("span",{class:"title-font"},t[this.keysArray[0]]),this.keysArray[1]&&e("span",{class:"subtitle"},t[this.keysArray[1]])))))))}get element(){return h(this)}static get style(){return"div.dxp.dxp-tag-input{position:relative}div.dxp.dxp-tag-input input.searchbox{padding:0;height:auto;width:auto;display:inline-block;border:none}div.dxp.dxp-tag-input input.searchbox:focus{-webkit-box-shadow:none;box-shadow:none}div.dxp.dxp-tag-input .tag-div{min-height:40px;max-height:68px;border-radius:4px;padding:7px 10px;overflow-y:auto;overflow-x:hidden}div.dxp.dxp-tag-input .tag-div .tag-block{display:inline-block}div.dxp.dxp-tag-input .tags{padding:3px 30px 3px 11px;border-radius:19.5px;position:relative;display:inline-block;margin-right:5px}div.dxp.dxp-tag-input .tags .icon-close{position:absolute;top:7px;right:5px;cursor:pointer}div.dxp.dxp-tag-input .dxp-list-container{border-radius:5px;border:none;margin:auto;top:42px;left:0;right:0}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list{margin:0;padding:8px 0 20px 0}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list .dxp-dropdown-list-item span{display:block;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list div>span:first-of-type{padding-left:17px;cursor:default}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list li{height:auto;line-height:normal;padding:4.5px 34px 7.5px 19px;margin-top:6px}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list li:after{border-top:none;border-bottom:none}div.dxp.dxp-tag-input .dxp-list-container .dxp-dropdown-list .group-title{padding-left:17px;cursor:default}div.dxp.dxp-tag-input[dir=rtl] .dxp-list-container .dxp-dropdown-list li{padding:4px 19px 5px 34px}div.dxp.dxp-tag-input[dir=rtl] .dxp-list-container .dxp-dropdown-list div>span:first-of-type{padding-left:0;padding-right:17px;cursor:default}div.dxp.dxp-tag-input[dir=rtl] .tags{padding:3px 11px 3px 30px}div.dxp.dxp-tag-input[dir=rtl] .tags .icon-close{right:auto;left:5px}"}};export{p as dxp_tag_input};