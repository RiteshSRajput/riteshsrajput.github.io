import{r as t,c as s,d as i,h,g as e}from"./p-8188e849.js";import{B as o}from"./p-16d6f0ca.js";const a={en:{play:"Play"}},l=class{constructor(i){t(this,i),this.autoplay=!1,this.customMuteButton=!1,this.customMuteButtonPosition="top-right",this.disableControls=!1,this.fullHeight=!1,this.iconType="light",this.muted=!0,this.analyticsDataEmitter=s(this,"dxp_comp",7)}componentWillLoad(){this.base=new o(this,i),this.base.i18Init(i,"Video",a),this.disableControls&&(this.autoplay=!0),this.srcVideo?this.formVideoSource():i.log.debug(this.element.tagName,"componentWillLoad()","Source id is missing")}componentDidLoad(){(this.autoplay&&"hostedInternally"===this.type||"hostedExternally"===this.type&&this.srcVideo.toLowerCase().indexOf("akamai")>0)&&(this.width||this.videoElementRef.setAttribute("width","100%")),this.autoplay&&this.emitAnalyticsData("play"),this.schemaScript(),this.lazyLoadVideo()}componentDidUpdate(){this.lazyLoadVideo()}keyDownHandler(t){13!==t.keyCode&&32!==t.keyCode||this.iframePoster&&"none"!==this.iframePoster.style.display&&this.onPosterClick()}async pauseVideo(){this.base.shadowRootQuerySelector(this.element,"video").pause()}async playVideo(){this.base.shadowRootQuerySelector(this.element,"video").play()}disableVideoControls(){return this.disableControls&&this.customMuteButton?h("button",{ref:t=>this.customMuteRef=t,onClick:()=>{this.toggleMute()},class:`${this.customMuteButtonPosition} custom-control`},h("i",{class:`${this.muted?"mute-icon":"unmute-icon"}`})):""}emitAnalyticsData(t){const s={di_comp_name:this.element.tagName,di_comp_title:this.srcVideo,di_comp_videoname:this.videoName,di_comp_videoaction:t};this.analyticsDataEmitter.emit(s),i.log.info(this.element.tagName,"emitAnalyticsData()",s)}fallBack(){const t=this.base.shadowRootQuerySelector(this.element,"video",!1),s=this.base.shadowRootQuerySelector(this.element,"img",!1);setTimeout(()=>{const i=window.pageYOffset;t&&t.offsetTop<window.innerHeight+i&&(t.src=t.dataset.src),s&&s.offsetTop<window.innerHeight+i&&(s.src=s.dataset.src)},20)}formVideoSource(){this.type&&"youtube"===this.type.toLocaleLowerCase()?this.handleYoutube():this.type&&"vimeo"===this.type.toLocaleLowerCase()?this.handleVimeo():this.type&&"youku"===this.type.toLocaleLowerCase()?this.handleYouku():this.videoSource=this.autoplay?`${this.srcVideo}?autoplay=1`:this.srcVideo}handleAkamai(){const t=h("div",{ref:t=>this.iframePoster=t,onClick:()=>this.onPosterClick(),tabindex:"0",class:"video-thumbnail","aria-label":i.i18n.t("Video:play"),style:{display:this.autoplay?"none":"block"}},h("img",{"data-src":this.srcPoster,style:{display:this.srcPoster?"block":"none"}}),h("div",{class:"video-poster"},h("img",{"data-src":`https://asset.mastercard.com/dxp-ui/assets/dxp-video/play-icon-${this.iconType}.png`})));return h("div",{tabindex:"0",class:this.fullHeight?"full-height-video":"embed-responsive embed-responsive-16by9"},h("iframe",{ref:t=>this.iframeRef=t,style:{display:this.autoplay||!this.srcPoster?"block":"none"},class:this.fullHeight?"full-height-video":"embed-responsive-item",src:this.autoplay||!this.srcPoster?this.videoSource:"",frameborder:"0",allowFullScreen:!0}),t)}handleVimeo(){if(this.videoSource=this.is_url(this.srcVideo)?this.srcVideo.slice(this.srcVideo.lastIndexOf("/")+1,this.srcVideo.length):this.srcVideo,this.videoSource="https://player.vimeo.com/video/"+this.videoSource,this.videoSource=this.autoplay?`${this.videoSource}?autoplay=1`:this.videoSource,this.disableControls){const t=this.videoSource.split("?")[0];this.videoSource=`${t}?autoplay=1&api=1&background=1&loop=1`}}handleYouku(){let t;const s="https://player.youku.com/embed/";this.is_url(this.srcVideo)?-1===this.srcVideo.indexOf("/embed/")?(t=(t=this.srcVideo.split("id_"))[1].split(".html"),this.videoSource=t[0].slice(0),this.videoSource=s+this.videoSource):this.videoSource=this.srcVideo:(this.videoSource=this.srcVideo,this.videoSource=s+this.videoSource),this.videoSource=this.autoplay?`${this.videoSource}?autoplay=1`:this.videoSource}handleYoutube(){let t,s;const i="https://www.youtube.com/embed/";if(this.is_url(this.srcVideo)?-1===this.srcVideo.indexOf("/embed/")?(t=(t=s=this.srcVideo.split("?"))[1].split("=")[1],s=s[1].split("&"),this.videoSource=s[0].slice(2),this.videoSource=i+this.videoSource):(this.videoSource=this.srcVideo,t=this.srcVideo.split("embed/")[1].split("?")[0]):(t=this.srcVideo,this.videoSource=this.srcVideo,this.videoSource=i+this.videoSource),this.videoSource=this.autoplay?`${this.videoSource}?autoplay=1`:this.videoSource,this.disableControls){const s=this.videoSource.split("?")[0];this.videoSource=`${s}?autoplay=1&controls=0&showinfo=0&rel=0&version=3&loop=1&playlist=${t}`}}is_url(t){return!!/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(t)}lazyLoadVideo(){let t,s;if(window.IntersectionObserver){t=this.base.shadowRootQuerySelector(this.element,"video",!1),s=this.base.shadowRootQuerySelector(this.element,"img",!1);const i=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const s=t.target;s.src=s.dataset.src,i.unobserve(s)}})}),h=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const s=t.target;s.src=s.dataset.src,h.unobserve(s)}})});t&&i.observe(t),s&&h.observe(s)}else this.fallBack()}onPosterClick(){this.iframeRef.setAttribute("src",`${this.videoSource}?autoplay=1`),this.iframeRef.setAttribute("style","display:block"),this.iframePoster.setAttribute("style","display:none"),this.emitAnalyticsData("play")}schemaScript(){const t=JSON.stringify({"@context":"http://schema.org","@type":"VideoObject",name:this.videoName,description:this.videoDescription,thumbnailUrl:this.srcPoster,uploadDate:this.videoUploadDate,contentUrl:this.videoSource});this.base.createSeoSchema(i,this.element,t)}toggleMute(){this.muted=!this.muted,this.emitAnalyticsData(this.muted?"mute":"unmute")}render(){i.log.debug(this.element.tagName,"render()","in dxp-video render() : DEVELOPMENT");const t=h("span",null,h("link",{rel:"stylesheet",href:""}),this.theme&&h("link",{rel:"stylesheet",href:""}),this.theme&&h("link",{rel:"stylesheet",href:`${i.config.get("DXP_STYLE_BASE_URL")}/themes/${this.theme}/dxp-video.min.css`}),this.dtmUrl&&h("script",{src:this.dtmUrl}));return h("div",{class:this.base.componentClass(),"data-theme":this.theme,style:{width:`${this.width}px`,height:this.fullHeight?"100%":""}},t,(()=>"hostedInternally"!==this.type&&this.srcVideo&&-1===this.srcVideo.toLowerCase().indexOf("akamai")?this.handleAkamai():h("div",{class:this.fullHeight?"full-height-video":"embed-responsive embed-responsive-16by9"},h("video",{ref:t=>this.videoElementRef=t,class:this.fullHeight?"full-height-video":"embed-responsive-item",poster:this.srcPoster,"data-src":this.videoSource,loop:!0,autoplay:this.autoplay,muted:this.muted,controls:!this.disableControls,width:this.width}),this.disableVideoControls()))())}get element(){return e(this)}static get style(){return"div.dxp.dxp-video{width:100%}div.dxp.dxp-video .top-left{position:absolute;top:0;left:0}div.dxp.dxp-video .top-right{position:absolute;top:0;right:0}div.dxp.dxp-video .bottom-right{position:absolute;bottom:0;right:0}div.dxp.dxp-video .bottom-left{position:absolute;bottom:0;left:0}div.dxp.dxp-video .custom-control{cursor:pointer;z-index:100;bottom:.9375rem;right:.9375rem;margin:.125rem;border-radius:50%;overflow:hidden;border:none;-webkit-backdrop-filter:blur(1.25rem);backdrop-filter:blur(1.25rem)}div.dxp.dxp-video .custom-control,div.dxp.dxp-video .custom-control i{display:inline-block;height:2.5rem;width:2.5rem}div.dxp.dxp-video .full-height-video{height:100%;width:100%}div.dxp.dxp-video .full-height-video iframe,div.dxp.dxp-video .full-height-video video{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);height:auto;width:auto;min-height:100%;min-width:100%}div.dxp.dxp-video .embed-responsive{position:relative;padding-bottom:56.25%;height:0}div.dxp.dxp-video .embed-responsive iframe{position:absolute;top:0;left:0;width:100%;height:100%}div.dxp.dxp-video .video-thumbnail{cursor:pointer;position:absolute;text-align:center;top:0;width:100%;height:100%}div.dxp.dxp-video .video-thumbnail img{width:100%;height:100%}div.dxp.dxp-video .video-overlay,div.dxp.dxp-video .video-poster{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}div.dxp.dxp-video .video-overlay{display:block;height:80px;width:80px}\@media (max-width:767.98px){div.dxp.dxp-video .embed-responsive{position:relative;display:block;width:100%!important;padding:0;height:auto!important;overflow:hidden}div.dxp.dxp-video .embed-responsive:before{display:block;content:\"\"}div.dxp.dxp-video .embed-responsive-item,div.dxp.dxp-video iframe,div.dxp.dxp-video video{position:absolute;top:0;bottom:0;left:0;width:100%;height:100%;border:0}div.dxp.dxp-video .embed-responsive-16by9:before{padding-top:56.25%}div.dxp.dxp-video .video-thumbnail{position:absolute;top:0}}"}};export{l as dxp_video};