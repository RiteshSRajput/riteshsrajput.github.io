import{r as t,c as s,d as i,h as e,g as h}from"./p-8188e849.js";import{B as r}from"./p-16d6f0ca.js";import{m as a,x as c}from"./p-72849a34.js";const n=class{constructor(i){t(this,i),this.count=-1,this.highlightLines=[],this.pageStart=0,this.tempResultsData=[],this.highlighter=[],this.noResult="",this.responseData=[],this.searchValue="",this.cfq="",this.cfqLocale="",this.descriptionLength=200,this.titleLength=65,this.analyticsDataEmitter=s(this,"dxp_comp",7)}componentWillLoad(){if(this.base=new r(this,i),this.base.i18Init(i,"Search",a),this.searchApiUrl&&this.searchFl&&this.searchCollection&&this.highlightFields&&this.sortingField){this.cfqLocale=this.cfqLocale?this.cfqLocale:this.locale.toLowerCase().replace("_","-"),this.searchEndPoint=`${this.searchApiUrl+this.searchCollection}`;const t=this.highlightFields.split(",");let s="";for(const i of t)s=`${s}${i}_${this.getPageLang(this.cfqLocale)},`;s=s.substring(0,s.length-1),this.searchConfig={rows:this.rows,start:this.start,hl:!0,"hl.fl":s,"hl.fragsize":80,"hl.simple.pre":encodeURIComponent("<b>"),"hl.simple.post":encodeURIComponent("</b>"),"hl.snippets":8,"hl.usePhraseHighlighter":!0,wt:"json"},this.promotionsData&&"string"==typeof this.promotionsData&&(this.promotionsData=JSON.parse(this.promotionsData)),this.promotionsKeywords&&(this.promotionsKeywordsArray=this.promotionsKeywords.split(","))}}async componentDidLoad(){if(window.location.href.indexOf(this.searchParamKey)>-1){i.log.debug(this.element.tagName,"componentDidLoad()","Search Result Component-received the redirect page query");let t=[];t=window.location.href.split(`${this.searchParamKey}=`),this.searchValue=decodeURIComponent(t[1].trim()),await this.setValue(this.searchValue)}}async handleKeyUp(t){const s=t.target?t.target.activeElement:t.target,i=s.classList.contains("searchbox"),e=s.classList.contains("dxp-icon-search"),h=s.classList.contains("dxp-btn-secondary"),r=s,a=t.keyCode;let c;if(38!==a&&40!==a||t.preventDefault(),(13===a||32===a)&&(e&&s.previousElementSibling.value.trim().length>=3&&await this.setValue(s.previousElementSibling.value),r.classList.contains("list-element")&&await this.setValue(s.innerText),13===a&&i&&s.value.trim().length>=3&&await this.setValue(s.value),13===a&&h)){const t=s.closest(".sc-dxp-search-result").querySelectorAll(".result-listing");t&&(this.tempElement=t[this.searchConfig.start+this.rows-1].querySelector("a"))}if(40===a&&i&&(c=s.closest("div").querySelectorAll("li"))[0]&&this.focusElement(c[0]),38===a&&r.classList.contains("list-element")&&(c=s.closest("div").querySelectorAll("li"))[0]){const t=this.getInputElement();this.focusElement(t)}40===a&&s.closest(".dxp-dropdown-list")&&s.nextElementSibling&&this.focusElement(s.nextElementSibling),38===a&&s.closest(".dxp-dropdown-list")&&s.previousElementSibling&&this.focusElement(s.previousElementSibling)}routingHandler(t){this.base.routingEventListener(t)}async searchTermChangedHandler(t){i.log.debug(this.element.tagName,"searchTermChangedHandler()","Search Result Component-received the custom search term changed event: ",t.detail.searchTerm),this.searchValue=t.detail.searchTerm,await this.setValue(this.searchValue)}async analyticSearchResult(){const t={di_comp_name:this.element.tagName,di_comp_searchfound:this.resultCount?"true":"false",di_comp_searchterm:this.searchValue,di_comp_searchresults:this.resultCount,di_comp_searchCollection:this.suggestCollection};this.analyticsDataEmitter.emit(t),i.log.info(this.element.tagName,"analyticSearchResult()",t)}async setValue(t){this.searchValue=t,this.searchValue.trim().length&&this.changeSearchResults(!0).then(async()=>{i.log.info(this.element.tagName,"setValue()","in searchData"),await this.analyticSearchResult()}).catch(t=>i.log.error(this.element.tagName,"setValue()",`in searchData :${t}`))}async changeSearchResults(t){let s;this.element.querySelector(".dxp-list-container").classList.remove("dxp-show"),this.getInputElement().value=this.searchValue,s=this.tags?`(url:"${i.util.addEscapeCharacter(this.cfq+("global"===this.cfqLocale.toLowerCase().trim()?"global":this.cfqLocale))}" AND (${this.sortingField}_${this.getPageLang(this.cfqLocale)}:(${i.util.addEscapeCharacter(this.searchValue.trim()).replace(new RegExp("\\ ","g")," AND ")})) AND tags:"${i.util.addEscapeCharacter(this.tags)}")`:`(url:"${i.util.addEscapeCharacter(this.cfq+("global"===this.cfqLocale.toLowerCase().trim()?"global":this.cfqLocale))}" AND (${this.sortingField}_${this.getPageLang(this.cfqLocale)}:(${i.util.addEscapeCharacter(this.searchValue.trim()).replace(new RegExp("\\ ","g")," AND ")})))`,t&&(this.pageStart=0,this.searchConfig.start=0),this.searchConfig.fl=encodeURIComponent(`termfreq(${this.sortingField}_${this.getPageLang(this.cfqLocale)},'${i.util.addEscapeCharacter(this.searchValue.trim())}'),${this.searchFl}`),this.searchConfig.sort=encodeURIComponent(`termfreq(${this.sortingField}_${this.getPageLang(this.cfqLocale)},'${i.util.addEscapeCharacter(this.searchValue.trim())}') desc,start_time asc`),this.responseData=await this.getSearchData(this.searchConfig,this.searchEndPoint,s).then(async s=>{let i;this.responseData=s,this.searchResults=this.responseData,this.searchResults&&this.searchResults.response?(this.resultCount=this.responseData.response.numFound,i=this.highlightSearchKeyword(this.responseData.response.docs,this.responseData.highlighting),t?(this.searchResults.response.docs=i,this.tempResultsData=this.searchResults.response.docs):(this.searchResults.response.docs=[...this.tempResultsData,...i],this.tempResultsData=this.searchResults.response.docs)):(this.searchResults=[],this.resultCount=0)}).catch(t=>{i.log.error(this.element.tagName,"changeSearchResults()","Error in dxp-search fetch service: ",t)}),this.noResult=0===this.resultCount||this.searchResults&&500===this.searchResults.status?"noresult":"result"}focusElement(t){t.focus()}getInputElement(){return this.element.querySelector(".searchbox")}getPageLang(t){let s=(t="global"===t.toLowerCase().trim()?this.locale.toLowerCase().replace("_","-"):t)&&t.substring(0,2);return 0!==s.indexOf("zh")&&0!==s.indexOf("ko")||(s="cjk"),s}getSearchData(t,s,e){let h;h=t,s.indexOf("search")>-1&&(h.q=encodeURIComponent(e));const r={method:"POST",body:Object.keys(h).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(h[t])}`).join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}};try{return c.request&&c.request.abort(),c.fetchRequest(s,r).then(t=>(i.log.debug(this.element.tagName,"getSearchData()","xhr request success"),JSON.parse(t.response))).catch(t=>{i.log.debug(this.element.tagName,"getSearchData()",`xhr request cancelled/failed : ${JSON.stringify(t)}`)})}catch(a){i.log.error(this.element.tagName,"getSearchData()","fetch failed",a)}}highlightSearchKeyword(t,s){let e,h,r,a;for(const c of t)if(c.title){const t=c.id;h="",e="";const n=`_${this.getPageLang(this.cfqLocale)}`;if(r=`content${this.getPageLang(this.cfqLocale)?n:""}`,a=`title${this.getPageLang(this.cfqLocale)?n:""}`,s[t][a])for(const i of s[t][a])h+=i;else h=c.title;if(h.length>this.titleLength&&(h=`${(h=h.substring(0,this.titleLength)).substring(0,h.lastIndexOf(" "))} ...`),s[t][r]){e="...";for(const i of s[t][r])e=`${e} ${i} ... `}else c.description&&(e=c.description);e.length>this.descriptionLength&&(e=(e=e.substring(0,this.descriptionLength)).substring(0,e.lastIndexOf(" "))).lastIndexOf("... ")!==e.length-5&&e.lastIndexOf(" ...")!==e.length-5&&e.lastIndexOf("...")!==e.length-3&&(e=`${e} ...`),h&&(c.title=h,c.description=e||i.i18n.t("Search:skipContent"))}else this.resultCount=0,t.length=0;return t}renderSearchResults(t){return t.map(t=>e("div",{class:"result-listing"},e("div",null,e("a",{href:`${t.url}`,class:"column-item-link",innerHTML:t.title})),e("div",{class:"data-description",innerHTML:t.description})))}scrollToTop(){this.getInputElement().scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}viewMore(){this.pageStart=this.pageStart+1,this.searchConfig.start=this.rows*this.pageStart,this.changeSearchResults(!1).then(()=>i.log.info(this.element.tagName,"viewMore()","in searchData")).catch(t=>i.log.error(this.element.tagName,"viewMore()",`in searchData :${t}`)),this.tempElement&&this.focusElement(this.tempElement)}render(){if(i.log.debug(this.element.tagName,"render()","in dxp-search-result render() : DEVELOPMENT"),!this.searchConfig)return void i.log.debug(this.element.tagName,"render()","component not rendered : check suggester and search config object");const t=e("span",null,e("link",{rel:"stylesheet",href:""}),this.theme&&e("link",{rel:"stylesheet",href:""}),this.theme&&e("link",{rel:"stylesheet",href:`${i.config.get("DXP_STYLE_BASE_URL")}/themes/${this.theme}/dxp-search-result.min.css`}),this.dtmUrl&&e("script",{src:this.dtmUrl}));return e("div",{class:this.base.componentClass(),dir:this.dir,"data-theme":this.theme},t,e("div",{id:"search-results",class:"sc-dxp-search-result search-results",role:"application"},e("div",{class:"dxp-row"},e("div",{class:"sc-dxp-search-result dxp-col-12 search-container"},e("dxp-searchbox",{"suggest-collection":this.suggestCollection,cfq:this.cfq,placeholder:this.placeholder,"suggest-api-url":this.suggestApiUrl,"cfq-locale":this.cfqLocale,"suggest-count":this.suggestCount,"suggest-dictionary":this.suggestDictionary,"no-result-flag":this.noResult,"searched-text":this.searchValue,"searched-term":this.searchValue,"result-count":this.resultCount,"error-text":this.errorMessage}),e("div",{class:"sc-dxp-search-result dxp-col-lg-8 dxp-col-md-12 dxp-col-12 dxp-p-0"},this.showPromotions&&this.promotionsData&&this.promotionsKeywordsArray.some(t=>this.searchValue.toLowerCase()===t.toLowerCase())&&this.searchResults&&this.searchResults.response&&this.renderSearchResults(this.promotionsData),this.searchResults&&this.searchResults.response&&this.searchResults.response.docs&&this.renderSearchResults(this.searchResults.response.docs)))),this.searchResults&&this.searchResults.response&&this.searchResults.response.docs.length!==this.resultCount&&e("div",{class:"dxp-col-12 view-more-button"},e("button",{"aria-label":this.viewMoreText,class:"dxp-btn dxp-btn-secondary dxp-btn-lg",onClick:()=>this.viewMore()},this.viewMoreText))))}get element(){return h(this)}static get style(){return"div.dxp.dxp-search-result .search-results{padding-top:5rem}div.dxp.dxp-search-result .search-results .no-result-message{list-style-type:disc;padding-left:.75rem;padding-top:.625rem}div.dxp.dxp-search-result .search-results .view-more-button{position:relative;padding:4rem 0 6.19rem 0}div.dxp.dxp-search-result .search-results .result-count-align{margin-bottom:1.625rem}div.dxp.dxp-search-result .search-results .dxp-icon-close{position:absolute;top:.9375rem;right:.9375rem;margin:0;padding:0;cursor:pointer}div.dxp.dxp-search-result .search-results .wrapper{position:relative}div.dxp.dxp-search-result .search-results .dxp-dropdown-list li{height:auto;line-height:normal}div.dxp.dxp-search-result .search-results .dxp-dropdown-list li:after{display:none}div.dxp.dxp-search-result .search-results .searchbox{height:2.5rem;padding:.68rem 2.2rem .5rem 2.5rem;border-radius:2.1875rem;margin-bottom:2.375rem}div.dxp.dxp-search-result .search-results .searchbox+.dxp-icon-search{position:absolute;cursor:pointer;left:.875rem;top:.75rem}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container{border:0;background:none;margin-top:.625rem;position:relative;top:-.0625rem}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container.dxp-show{border-top:none}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container ul{max-height:15rem;overflow-y:auto}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container li{margin-bottom:.2188rem;text-align:left;padding-left:2.5rem}div.dxp.dxp-search-result .search-results .searchbox~.dxp-list-container li:after{height:3.0625rem;left:1%}div.dxp.dxp-search-result .search-results .search-terms{text-transform:uppercase;letter-spacing:.0625rem;margin-top:3.5rem}div.dxp.dxp-search-result .search-results .result-listing{padding:1.125rem 0}div.dxp.dxp-search-result .search-results .result-listing .column-item-link{margin-bottom:.1875rem;margin-top:inherit}div.dxp.dxp-search-result .search-results .result-listing .column-item-link:after,div.dxp.dxp-search-result .search-results .result-listing .column-item-link:before{background:none}div.dxp.dxp-search-result .search-results .search-box-wrapper{position:relative}div.dxp.dxp-search-result[dir=rtl] .search-results .searchbox{padding:.68rem 2.2rem .5rem 3.125rem}div.dxp.dxp-search-result[dir=rtl] .search-results .searchbox+.dxp-icon-search{right:.75rem}div.dxp.dxp-search-result[dir=rtl] .search-results .searchbox~.dxp-list-container li{padding-right:2.125rem;text-align:right}div.dxp.dxp-search-result[dir=rtl] .search-results .dxp-icon-close{left:.9375rem;right:auto}"}};export{n as dxp_search_result};