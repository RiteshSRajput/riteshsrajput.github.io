var __awaiter=this&&this.__awaiter||function(e,t,s,r){function a(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function i(e){try{c(r.next(e))}catch(t){n(t)}}function o(e){try{c(r["throw"](e))}catch(t){n(t)}}function c(e){e.done?s(e.value):a(e.value).then(i,o)}c((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var s={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,a,n,i;return i={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function o(e){return function(t){return c([e,t])}}function c(i){if(r)throw new TypeError("Generator is already executing.");while(s)try{if(r=1,a&&(n=i[0]&2?a["return"]:i[0]?a["throw"]||((n=a["return"])&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;if(a=0,n)i=[i[0]&2,n.value];switch(i[0]){case 0:case 1:n=i;break;case 4:s.label++;return{value:i[1],done:false};case 5:s.label++;a=i[1];i=[0];continue;case 7:i=s.ops.pop();s.trys.pop();continue;default:if(!(n=s.trys,n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){s=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(i[0]===6&&s.label<n[1]){s.label=n[1];n=i;break}if(n&&s.label<n[2]){s.label=n[2];s.ops.push(i);break}if(n[2])s.ops.pop();s.trys.pop();continue}i=t.call(e,s)}catch(o){i=[6,o];a=0}finally{r=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};System.register(["./p-f4cc861d.system.js","./p-4b0c1219.system.js","./p-33b84f15.system.js"],(function(e){"use strict";var t,s,r,a,n,i,o;return{setters:[function(e){t=e.r;s=e.d;r=e.h;a=e.g},function(e){n=e.B},function(e){i=e.m;o=e.x}],execute:function(){var c="getSuggestData()";var h=e("dxp_searchbox",function(){function e(e){t(this,e);this.count=-1;this.contentSuggesterData=[];this.responseData=[];this.searchDataCombined=[];this.searchFilteredData=[];this.searchValue="";this.showSearchDropdown=false;this.cfq="";this.cfqLocale="";this.searchedTerm="";this.searchedText=""}e.prototype.componentWillLoad=function(){this.base=new n(this,s);this.base.i18Init(s,"Search",i);if(this.suggestApiUrl&&this.suggestCount&&this.suggestDictionary&&this.suggestCollection&&this.cfq){this.cfqLocale=this.cfqLocale?this.cfqLocale:this.locale.toLowerCase().replace("_","-");this.suggestEndPoint=""+(this.suggestApiUrl+this.suggestCollection);this.suggesterConfig={"suggest.count":this.suggestCount,"suggest.dictionary":this.suggestDictionary,suggest:"true","suggest.cfq":encodeURIComponent(s.util.addEscapeCharacter(""+this.cfq+this.cfqLocale+"*"))}}};e.prototype.componentDidLoad=function(){this.inputBoxSearch=this.element.querySelector(".searchbox")};e.prototype.componentWillUpdate=function(){this.searchValue=this.searchedTerm?this.searchedTerm:this.searchValue};e.prototype.clickEvent=function(e){if(!e.target.classList.contains("dxp-list-container")&&!e.target.classList.contains("searchbox")){this.showSearchDropdown=false}};e.prototype.handleKeyUp=function(e){var t=e.target?e.target.activeElement:e.target;var s=t;var r=e.keyCode;var a=t.classList.contains("searchbox");var n=t.classList.contains("dxp-icon-search");var i=t.classList.contains("dxp-icon-clear");if(r===13||r===32){if(s.classList.contains("list-element")){this.searchValue=t.innerText;this.showSearchDropdown=false}if(n||r===13&&a){this.showSearchDropdown=false}if(i){this.clearSearchBox();this.inputBoxSearch.focus()}}};e.prototype.routingHandler=function(e){this.base.routingEventListener(e)};e.prototype.clearSearchBox=function(){var e=this.getInputElement();if(e){e.value="";this.searchValue=this.searchedTerm=""}};e.prototype.getInputElement=function(){return this.element.querySelector(".searchbox")};e.prototype.getSuggestData=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){var a,n,i,h;var l=this;return __generator(this,(function(u){a=e;if(t.indexOf("suggest")>-1){a["suggest.q"]=encodeURIComponent(r)}n=Object.keys(a).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(a[e])})).join("&");i={method:"POST",body:n,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}};try{if(o.request){o.request.abort()}h=o.fetchRequest(t,i).then((function(e){s.log.debug(l.element.tagName,c,"xhr request success");return JSON.parse(e["response"])})).catch((function(e){s.log.debug(l.element.tagName,c,"xhr request cancelled/failed : "+JSON.stringify(e))}));this.responseData=h;return[2,this.responseData]}catch(p){s.log.error(this.element.tagName,c,"fetch failed",p)}return[2]}))}))};e.prototype.handleChange=function(e){return __awaiter(this,void 0,void 0,(function(){var t,s,r,a,n,i,o,c,h,l;return __generator(this,(function(u){switch(u.label){case 0:this.count=-1;this.searchDataCombined=[];this.contentSuggesterData=[];this.searchFilteredData=[];this.searchValue=e;t=this.searchValue.trim();if(!(t.length>=3))return[3,2];s=this;return[4,this.getSuggestData(this.suggesterConfig,this.suggestEndPoint,t)];case 1:s.responseData=u.sent();if(this.responseData&&this.responseData.suggest){this.contentSuggesterData=this.responseData.suggest.contentSuggester}if(this.contentSuggesterData[t]){this.searchFilteredData=this.contentSuggesterData[t].suggestions}for(r=0,a=this.searchFilteredData;r<a.length;r++){n=a[r];i=n.term.toLowerCase();o=i.indexOf(t.toLowerCase());i=i.substr(o,i.length);c=i.split(" ");h=c.length;i="";for(l=0;l<h&&l<5;l++){i+=c[l];i+=" "}this.searchDataCombined.push(i)}this.searchDataCombined=this.removeDuplicates(this.searchDataCombined);this.searchDataCombined.length>0?this.showSearchDropdown=true:this.showSearchDropdown=false;u.label=2;case 2:return[2]}}))}))};e.prototype.onTextInput=function(e){var t=this;this.searchedTerm="";this.handleChange(e.target.value).then((function(){return s.log.info(t.element.tagName,"onTextInput()","in handleChange")})).catch((function(e){return s.log.error(t.element.tagName,"onTextInput()","in handleChange :"+e)}))};e.prototype.removeDuplicates=function(e){e=e.filter((function(t,s){return e.indexOf(t)===s}));return Array.from(e)};e.prototype.setSearchValue=function(e){this.showSearchDropdown=false;if(this.searchValue.trim().length>=3){e.setValue(this.searchValue)}};e.prototype.render=function(){var e=this;var t=document.querySelector("dxp-search-result");s.log.debug(this.element.tagName,"render()","in dxp-searchbox render() : "+"DEVELOPMENT");return[r("div",{class:"sc-dxp-search-result dxp-col-12 dxp-col-lg-6 search-box-wrapper dxp-p-0"},r("div",{class:"sc-dxp-search-result"},r("div",{class:"sc-dxp-search-result dxp-search-info"},this.searchedText?[r("span",{class:"sc-dxp-search-result"},s.i18n.t("Search:searchMessage")),r("span",{class:"search-keywords"}," "+this.searchedText," ")]:""),r("div",{class:"sc-dxp-search-result dxp-search-count result-count-align"},this.noResultFlag==="noresult"&&this.searchedText?r("span",null,s.i18n.t("Search:noResultFound")):this.searchedText===""?"":this.resultCount?r("span",null,this.resultCount+" ",s.i18n.t("Search:searchFound")):"")),r("div",{role:"application",class:"sc-dxp-search-result wrapper"},r("input",{type:"text",role:"combobox","aria-haspopup":"listbox",name:"searchbox","aria-label":s.i18n.t("Search:customMessage"),value:this.searchValue||this.searchedTerm,onInput:function(t){e.onTextInput(t)},class:"sc-dxp-search-result dxp-form-control searchbox"+(this.showSearchDropdown&&this.searchValue.length>=3?" no-border-radius":""),placeholder:this.placeholder}),r("span",{tabindex:"0","aria-label":s.i18n.t("Search:searchIconAccessibilityText"),class:"sc-dxp-search-result dxp-icon dxp-icon-medium dxp-icon-search",onClick:function(){return e.setSearchValue(t)}}),r("span",{tabindex:"0","aria-label":s.i18n.t("Search:clear"),class:"sc-dxp-search-result dxp-icon dxp-icon-small dxp-icon-close dxp-icon-clear"+(this.searchValue.length?" dxp-block":" dxp-none"),onClick:function(){return e.clearSearchBox()}}),r("div",{class:"dxp-list-container sc-dxp-search-result "+(this.showSearchDropdown&&this.searchValue.length>=3?"dxp-block":"")},r("ul",{class:"dxp-dropdown-list sc-dxp-search-result","aria-label":s.i18n.t("Search:listText")},this.searchDataCombined&&this.searchDataCombined.map((function(a,n){return r("li",{class:"list-element sc-dxp-search-result",id:"opt-"+(n+1),"aria-label":s.i18n.t("Search:selectedItem",{item:a}),onClick:function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:this.searchValue=a;return[4,t.setValue(a)];case 1:e.sent();return[2]}}))}))},tabindex:"-1"},a," ")})))))),r("div",{class:"sc-dxp-search-result dxp-col-12 dxp-bold"},this.noResultFlag==="noresult"&&this.searchedText?r("div",{class:"sc-dxp-search-result search-terms",innerHTML:this.errorText}):"")]};Object.defineProperty(e.prototype,"element",{get:function(){return a(this)},enumerable:true,configurable:true});return e}())}}}));